Received: from cthulhu.engr.sgi.com (cthulhu.engr.sgi.com [192.26.80.2]) by neteng.engr.sgi.com (980327.SGI.8.8.8/970903.SGI.AUTOCF) via ESMTP id OAA819755 for <linux-archive@neteng.engr.sgi.com>; Mon, 18 May 1998 14:56:48 -0700 (PDT)
Return-Path: <owner-linux@cthulhu.engr.sgi.com>
Received: (from majordomo-owner@localhost)
	by cthulhu.engr.sgi.com (980427.SGI.8.8.8/970903.SGI.AUTOCF)
	id OAA89744
	for linux-list;
	Mon, 18 May 1998 14:55:08 -0700 (PDT)
	mail_from (owner-linux@relay.engr.sgi.com)
Received: from sgi.sgi.com (sgi.engr.sgi.com [192.26.80.37])
	by cthulhu.engr.sgi.com (980427.SGI.8.8.8/970903.SGI.AUTOCF)
	via ESMTP id OAA92433
	for <linux@cthulhu.engr.sgi.com>;
	Mon, 18 May 1998 14:55:06 -0700 (PDT)
	mail_from (adevries@engsoc.carleton.ca)
Received: from lager.engsoc.carleton.ca (lager.engsoc.carleton.ca [134.117.69.26]) by sgi.sgi.com (980309.SGI.8.8.8-aspam-6.2/980304.SGI-aspam: SGI does not authorize the use of its proprietary systems or networks for unsolicited or bulk email from the Internet.) via ESMTP id OAA21755
	for <linux@cthulhu.engr.sgi.com>; Mon, 18 May 1998 14:55:04 -0700 (PDT)
	mail_from (adevries@engsoc.carleton.ca)
Received: from localhost (adevries@localhost)
	by lager.engsoc.carleton.ca (8.8.7/8.8.7) with SMTP id RAA30492;
	Mon, 18 May 1998 17:49:54 -0400
X-Authentication-Warning: lager.engsoc.carleton.ca: adevries owned process doing -bs
Date: Mon, 18 May 1998 17:49:53 -0400 (EDT)
From: Alex deVries <adevries@engsoc.carleton.ca>
To: ralf@uni-koblenz.de
cc: SGI Linux <linux@cthulhu.engr.sgi.com>
Subject: prom_open() problems.
In-Reply-To: <19980128204307.61681@uni-koblenz.de>
Message-ID: <Pine.LNX.3.95.980518174635.20171G-200000@lager.engsoc.carleton.ca>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="1971722821-1405645646-895528193=:20171"
Sender: owner-linux@cthulhu.engr.sgi.com
Precedence: bulk

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--1971722821-1405645646-895528193=:20171
Content-Type: TEXT/PLAIN; charset=US-ASCII


Attached is the start of an implementation to allow for initrd's to sit on
an EFS or VH, and be read using prom_open/read/close.  The file is
hardcoded right now, although there is the start of parameter handling
(before start_kernel()).

The problem that I'm having is that prom_open() always returns 13, which I
think means that there is no such device.  I've used all possible strings,
but I've not found any paths that work, so I can't read the file.

No, you're not allowed to pick on my code, yet.

Could someone (Ralf?) explain why my prom_open() in
arch/mips/sgi/prom/initrd.c doesn't work?

- A
-- 
Alex deVries, puffin on LinuxNet.
http://www.engsoc.carleton.ca/~adevries/ .


--1971722821-1405645646-895528193=:20171
Content-Type: TEXT/PLAIN; charset=US-ASCII; name="prominitrd.diff"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.3.95.980518174953.20171H@lager.engsoc.carleton.ca>
Content-Description: 

ZGlmZiAtTnJjIC14IC5kZXBlbmQgLXggRW50cmllcyBsaW51eC9hcmNoL21p
cHMva2VybmVsL3NldHVwLmMgbGludXgtbWluZS1wcm9tLWluaXRyZC9hcmNo
L21pcHMva2VybmVsL3NldHVwLmMNCioqKiBsaW51eC9hcmNoL21pcHMva2Vy
bmVsL3NldHVwLmMJTW9uIE1heSAxOCAxNzoxNjoyNSAxOTk4DQotLS0gbGlu
dXgtbWluZS1wcm9tLWluaXRyZC9hcmNoL21pcHMva2VybmVsL3NldHVwLmMJ
TW9uIE1heSAxOCAwMDowNzoyNyAxOTk4DQoqKioqKioqKioqKioqKioNCioq
KiAxMjEsMTI4ICoqKioNCiAgI2VuZGlmDQogICNkZWZpbmUgTE9BREVSX1RZ
UEUgKCoodW5zaWduZWQgY2hhciAqKSAoUEFSQU0rMHgyMTApKQ0KICAjZGVm
aW5lIEtFUk5FTF9TVEFSVCAoKih1bnNpZ25lZCBsb25nICopIChQQVJBTSsw
eDIxNCkpDQotICNkZWZpbmUgSU5JVFJEX1NUQVJUICgqKHVuc2lnbmVkIGxv
bmcgKikgKFBBUkFNKzB4MjE4KSkNCi0gI2RlZmluZSBJTklUUkRfU0laRSAo
Kih1bnNpZ25lZCBsb25nICopIChQQVJBTSsweDIxYykpDQogIA0KICBzdGF0
aWMgY2hhciBjb21tYW5kX2xpbmVbQ0xfU0laRV0gPSB7IDAsIH07DQogICAg
ICAgICBjaGFyIHNhdmVkX2NvbW1hbmRfbGluZVtDTF9TSVpFXTsNCi0tLSAx
MjEsMTI2IC0tLS0NCioqKioqKioqKioqKioqKg0KKioqIDIxOCwyMjkgKioq
Kg0KICAJbWVtb3J5X2VuZCAtPSAxMjg7DQogIAltZW1vcnlfZW5kICY9IFBB
R0VfTUFTSzsNCiAgDQotICNpZmRlZiBDT05GSUdfQkxLX0RFVl9SQU0NCi0g
CXJkX2ltYWdlX3N0YXJ0ID0gUkFNRElTS19GTEFHUyAmIFJBTURJU0tfSU1B
R0VfU1RBUlRfTUFTSzsNCi0gCXJkX3Byb21wdCA9ICgoUkFNRElTS19GTEFH
UyAmIFJBTURJU0tfUFJPTVBUX0ZMQUcpICE9IDApOw0KLSAJcmRfZG9sb2Fk
ID0gKChSQU1ESVNLX0ZMQUdTICYgUkFNRElTS19MT0FEX0ZMQUcpICE9IDAp
Ow0KLSAjZW5kaWYNCi0gDQogIAlhdGFnID0gYmlfVGFnRmluZCh0YWdfbW91
bnRfcm9vdF9yZG9ubHkpOw0KICAJaWYgKGF0YWcpDQogIAkgIHJvb3RfbW91
bnRmbGFncyB8PSBNU19SRE9OTFk7DQotLS0gMjE2LDIyMSAtLS0tDQoqKioq
KioqKioqKioqKioNCioqKiAyNDEsMjQ4ICoqKioNCiAgDQogICNpZmRlZiBD
T05GSUdfQkxLX0RFVl9JTklUUkQNCiAgCWlmIChMT0FERVJfVFlQRSkgew0K
ISAJCWluaXRyZF9zdGFydCA9IElOSVRSRF9TVEFSVDsNCiEgCQlpbml0cmRf
ZW5kID0gSU5JVFJEX1NUQVJUK0lOSVRSRF9TSVpFOw0KICAJCWlmIChpbml0
cmRfZW5kID4gbWVtb3J5X2VuZCkgew0KICAJCQlwcmludGsoImluaXRyZCBl
eHRlbmRzIGJleW9uZCBlbmQgb2YgbWVtb3J5ICINCiAgCQkJICAgICAgICIo
MHglMDhseCA+IDB4JTA4bHgpXG5kaXNhYmxpbmcgaW5pdHJkXG4iLA0KLS0t
IDIzMywyNDAgLS0tLQ0KICANCiAgI2lmZGVmIENPTkZJR19CTEtfREVWX0lO
SVRSRA0KICAJaWYgKExPQURFUl9UWVBFKSB7DQohIAkJaW5pdHJkX3N0YXJ0
ID0gMCA7DQohIAkJaW5pdHJkX2VuZCA9IDAgOyANCiAgCQlpZiAoaW5pdHJk
X2VuZCA+IG1lbW9yeV9lbmQpIHsNCiAgCQkJcHJpbnRrKCJpbml0cmQgZXh0
ZW5kcyBiZXlvbmQgZW5kIG9mIG1lbW9yeSAiDQogIAkJCSAgICAgICAiKDB4
JTA4bHggPiAweCUwOGx4KVxuZGlzYWJsaW5nIGluaXRyZFxuIiwNCmRpZmYg
LU5yYyAteCAuZGVwZW5kIC14IEVudHJpZXMgbGludXgvYXJjaC9taXBzL3Nn
aS9wcm9tL01ha2VmaWxlIGxpbnV4LW1pbmUtcHJvbS1pbml0cmQvYXJjaC9t
aXBzL3NnaS9wcm9tL01ha2VmaWxlDQoqKiogbGludXgvYXJjaC9taXBzL3Nn
aS9wcm9tL01ha2VmaWxlCU1vbiBNYXkgMTggMTc6MTY6MzggMTk5OA0KLS0t
IGxpbnV4LW1pbmUtcHJvbS1pbml0cmQvYXJjaC9taXBzL3NnaS9wcm9tL01h
a2VmaWxlCVN1biBNYXkgMTcgMjM6MDc6MzIgMTk5OA0KKioqKioqKioqKioq
KioqDQoqKiogOSwxNSAqKioqDQogICMgTm90ZSAyISBUaGUgQ0ZMQUdTIGRl
ZmluaXRpb25zIGFyZSBub3cgaW4gdGhlIG1haW4gbWFrZWZpbGUuLi4NCiAg
DQogIE9CSlMgID0gY29uc29sZS5vIGluaXQubyBwcmludGYubyBtZW1vcnku
byB0cmVlLm8gdGFncy5vIGVudi5vIFwNCiEgICAgICAgY21kbGluZS5vIG1p
c2MubyB0aW1lLm8gZmlsZS5vDQogIA0KICBhbGw6IHByb21saWIuYQ0KICAN
Ci0tLSA5LDE1IC0tLS0NCiAgIyBOb3RlIDIhIFRoZSBDRkxBR1MgZGVmaW5p
dGlvbnMgYXJlIG5vdyBpbiB0aGUgbWFpbiBtYWtlZmlsZS4uLg0KICANCiAg
T0JKUyAgPSBjb25zb2xlLm8gaW5pdC5vIHByaW50Zi5vIG1lbW9yeS5vIHRy
ZWUubyB0YWdzLm8gZW52Lm8gXA0KISAgICAgICBjbWRsaW5lLm8gbWlzYy5v
IHRpbWUubyBmaWxlLm8gaW5pdHJkLm8NCiAgDQogIGFsbDogcHJvbWxpYi5h
DQogIA0KZGlmZiAtTnJjIC14IC5kZXBlbmQgLXggRW50cmllcyBsaW51eC9h
cmNoL21pcHMvc2dpL3Byb20vY21kbGluZS5jIGxpbnV4LW1pbmUtcHJvbS1p
bml0cmQvYXJjaC9taXBzL3NnaS9wcm9tL2NtZGxpbmUuYw0KKioqIGxpbnV4
L2FyY2gvbWlwcy9zZ2kvcHJvbS9jbWRsaW5lLmMJTW9uIE1heSAxOCAxNzox
NjozOCAxOTk4DQotLS0gbGludXgtbWluZS1wcm9tLWluaXRyZC9hcmNoL21p
cHMvc2dpL3Byb20vY21kbGluZS5jCU1vbiBNYXkgMTggMDM6MDM6NTAgMTk5
OA0KKioqKioqKioqKioqKioqDQoqKiogMTIsMTcgKioqKg0KLS0tIDEyLDIx
IC0tLS0NCiAgI2luY2x1ZGUgPGFzbS9zZ2lhbGliLmg+DQogICNpbmNsdWRl
IDxhc20vYm9vdGluZm8uaD4NCiAgDQorICNpbmNsdWRlIDxlcnJuby5oPg0K
KyANCisgI2luY2x1ZGUgImluaXRyZC5oIg0KKyANCiAgLyogI2RlZmluZSBE
RUJVR19DTURMSU5FICovDQogIA0KICBleHRlcm4gY2hhciBhcmNzX2NtZGxp
bmVbQ0xfU0laRV07DQoqKioqKioqKioqKioqKioNCioqKiA0Niw1NyAqKioq
DQogIAkJCWlmKCFzdHJuY21wKHByb21fYXJndlthY3RyXSwgaWdub3JlZFtp
XSwgbGVuKSkNCiAgCQkJCWdvdG8gcGljX2NvbnQ7DQogIAkJfQ0KLSAJCS8q
IE9rLCB3ZSB3YW50IGl0LiAqLw0KLSAJCXN0cmNweShjcCwgcHJvbV9hcmd2
W2FjdHJdKTsNCi0gCQljcCArPSBzdHJsZW4ocHJvbV9hcmd2W2FjdHJdKTsN
Ci0gCQkqY3ArKyA9ICcgJzsNCiAgDQohIAlwaWNfY29udDoNCiAgCQlhY3Ry
Kys7DQogIAl9DQogIAlpZiAoY3AgIT0gJihhcmNzX2NtZGxpbmVbMF0pKSAv
KiBnZXQgcmlkIG9mIHRyYWlsaW5nIHNwYWNlICovDQotLS0gNTAsODUgLS0t
LQ0KICAJCQlpZighc3RybmNtcChwcm9tX2FyZ3ZbYWN0cl0sIGlnbm9yZWRb
aV0sIGxlbikpDQogIAkJCQlnb3RvIHBpY19jb250Ow0KICAJCX0NCiAgDQoh
ICAgICAgICAgICAgICAgICAvKiBTbyBmYXIsIGl0IG1lYW5zIGl0IGlzbid0
IGEgdGFnIHRvIGJlIGlnbm9yZWQgKi8NCiEgDQohIA0KISAgICAgICAgICAg
ICAgICAgaWYgKCFzdHJuY21wKHByb21fYXJndlthY3RyXSwicHJvbV9pbml0
cmRfZmlsZT0iLDE3KSkgew0KISANCiEgICAgICAgICAgICAgICAgICAgICAg
ICAgc3RybmNweShwcm9tX2luaXRyZF9maWxlbmFtZSwNCiEgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBwcm9tX2FyZ3ZbYWN0cl0rMTcsDQoh
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RybGVuKHByb21f
YXJndlthY3RyXSktMTcpOw0KISANCiEgICAgICAgICAgICAgICAgIH0gZWxz
ZSBpZiAoIXN0cm5jbXAocHJvbV9hcmd2W2FjdHJdLCJwcm9tX2luaXRyZF9z
aXplPSIsMTcpKSB7DQohICAgICAgICAgICAgICAgICAgICAgICAgLyogVGhp
cyBpcyBqdXN0IGFuIHN0cnRvbCByZXBsYWNlbWVudCAqLw0KISAgICAgICAg
ICAgICAgICAgICAgICAgIGZvciAoaT0wO2k8c3RybGVuKHByb21fYXJndlth
Y3RyXSk7aSsrKSB7DQohICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgaWYgKChwcm9tX2FyZ3ZbYWN0cl1baV08JzAnKSB8fA0KISAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAocHJvbV9hcmd2W2FjdHJd
W2ldPic5JykpIHsNCiEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgIHByb21faW5pdHJkX3NpemU9MDsNCiEgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50aygiRXJyb3IgaW4g
UFJPTSByYW1kaXNrIHNpemUgZm9ybWF0dGluZ1xuIik7DQohICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiEgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQohICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgcHJvbV9pbml0cmRfc2l6ZSo9MTA7DQoh
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvbV9pbml0cmRf
c2l6ZSs9cHJvbV9hcmd2W2FjdHJdW2ldLScwJzsgICAgICANCiEgICAgICAg
ICAgICAgICAgICAgICAgICAgfSANCiEgICAgICAgICAgICAgICAgIH0gZWxz
ZSB7DQohICAgICAgICAgICAgICAgICAgICAgICAgIC8qIE9rLCB3ZSB3YW50
IGl0LiAqLw0KISAgICAgICAgICAgICAgICAgICAgICAgICBzdHJjcHkoY3As
IHByb21fYXJndlthY3RyXSk7DQohICAgICAgICAgICAgICAgICAgICAgICAg
IGNwICs9IHN0cmxlbihwcm9tX2FyZ3ZbYWN0cl0pOw0KISAgICAgICAgICAg
ICAgICAgICAgICAgICAqY3ArKyA9ICcgJzsNCiEgICAgICAgICAgICAgICAg
IH0NCiEgDQohICAgICAgICAgcGljX2NvbnQ6DQogIAkJYWN0cisrOw0KICAJ
fQ0KICAJaWYgKGNwICE9ICYoYXJjc19jbWRsaW5lWzBdKSkgLyogZ2V0IHJp
ZCBvZiB0cmFpbGluZyBzcGFjZSAqLw0KZGlmZiAtTnJjIC14IC5kZXBlbmQg
LXggRW50cmllcyBsaW51eC9hcmNoL21pcHMvc2dpL3Byb20vaW5pdC5jIGxp
bnV4LW1pbmUtcHJvbS1pbml0cmQvYXJjaC9taXBzL3NnaS9wcm9tL2luaXQu
Yw0KKioqIGxpbnV4L2FyY2gvbWlwcy9zZ2kvcHJvbS9pbml0LmMJTW9uIE1h
eSAxOCAxNzoxNjozOCAxOTk4DQotLS0gbGludXgtbWluZS1wcm9tLWluaXRy
ZC9hcmNoL21pcHMvc2dpL3Byb20vaW5pdC5jCU1vbiBNYXkgMTggMDA6MDE6
MTcgMTk5OA0KKioqKioqKioqKioqKioqDQoqKiogNywxMiAqKioqDQotLS0g
NywxMyAtLS0tDQogICAqLw0KICAjaW5jbHVkZSA8bGludXgvaW5pdC5oPg0K
ICAjaW5jbHVkZSA8bGludXgva2VybmVsLmg+DQorICNpbmNsdWRlICJpbml0
cmQuaCINCiAgDQogICNpbmNsdWRlIDxhc20vc2dpYWxpYi5oPg0KICANCioq
KioqKioqKioqKioqKg0KKioqIDE5LDI0ICoqKioNCi0tLSAyMCwyOCAtLS0t
DQogIGNoYXIgKipwcm9tX2FyZ3YsICoqcHJvbV9lbnZwOw0KICB1bnNpZ25l
ZCBzaG9ydCBwcm9tX3ZlcnMsIHByb21fcmV2Ow0KICANCisgDQorIGV4dGVy
biBpbnQgcHJvbV9pbml0cmRfbG9hZCh2b2lkICogaW5pdHJkX3N0YXJ0KTsN
CisgDQogIGV4dGVybiB2b2lkIHByb21fdGVzdHRyZWUodm9pZCk7DQogIA0K
ICBfX2luaXRmdW5jKGludCBwcm9tX2luaXQoaW50IGFyZ2MsIGNoYXIgKiph
cmd2LCBjaGFyICoqZW52cCkpDQoqKioqKioqKioqKioqKioNCioqKiA0Myw0
OSAqKioqDQotLS0gNDcsNzMgLS0tLQ0KICAJcHJvbV9yZXYgPSBwYi0+cmV2
Ow0KICAJcHJpbnRrKCJQUk9NTElCOiBTR0kgQVJDUyBmaXJtd2FyZSBWZXJz
aW9uICVkIFJldmlzaW9uICVkXG4iLA0KICAJCSAgICBwcm9tX3ZlcnMsIHBy
b21fcmV2KTsNCisgDQorICAgICAgICAgLyogSWYgdGhlIGluaXRyZCBzaXpl
IGhhc24ndCBiZWVuIHNldCB5ZXQgd2l0aCBhIGNvbW1hbmQgbGluZSwgdHJ5
IHRvDQorICAgICAgICAgICAgc3RhdCBpdCB3aXRoIGFyYy4gSWYgdGhhdCBk
b2Vzbid0IHdvcmssIGFzc3VtZSBpdCBpcyB0aGUgDQorICAgICAgICAgICAg
ZGVmYXVsdC4gICovDQorIA0KKyAgICAgICAgIGlmIChwcm9tX2luaXRyZF9z
aXplID09IDApIHsNCisgICAgICAgICAgICAgICAgLyogSSBkb24ndCB1bmRl
cnRhbmQgaG93IHRvIGRvIHRoZSBzdGF0IHlldCAqLw0KKyAgICAgICAgICAg
ICAgICBpZiAoMSkgew0KKyAgICAgICAgICAgICAgICAgICAgICAgIHByb21f
aW5pdHJkX3NpemUgPSBERUZBVUxUX0lOSVRSRF9TSVpFOw0KKyAgICAgICAg
ICAgICAgICB9IGVsc2Ugew0KKyAgICAgICAgICAgICAgICAgICAgICAgIHBy
b21faW5pdHJkX3NpemUgPSBERUZBVUxUX0lOSVRSRF9TSVpFOw0KKyAgICAg
ICAgICAgICAgIH0NCisgICAgICAgICB9DQorIA0KICAJcHJvbV9tZW1pbml0
KCk7DQorIA0KKyAgICAgICAgIC8qIExvYWQgdGhlIGRldmljZSBpbnRvIG1l
bW9yeSAqLw0KKyAgICAgICAgIHByaW50aygiQWJvdXQgdG8gbG9hZCBpbml0
cmQuLi4uXG4iKTsNCisgICAgICAgICBpbml0cmRfbG9hZChwcm9tX2luaXRy
ZF9zdGFydCk7DQorICAgICAgICAgcHJpbnRrKCJmaW5pc2hlZCB0cnlpbmcg
dG8gbG9hZCBpbml0cmQuLi4uXG4iKTsNCisgDQogIAlwcm9tX3NldHVwX2Fy
Y2h0YWdzKCk7DQogIA0KICAjaWYgMA0KZGlmZiAtTnJjIC14IC5kZXBlbmQg
LXggRW50cmllcyBsaW51eC9hcmNoL21pcHMvc2dpL3Byb20vaW5pdHJkLmMg
bGludXgtbWluZS1wcm9tLWluaXRyZC9hcmNoL21pcHMvc2dpL3Byb20vaW5p
dHJkLmMNCioqKiBsaW51eC9hcmNoL21pcHMvc2dpL3Byb20vaW5pdHJkLmMJ
VGh1IEphbiAgMSAwMDowMDowMCAxOTcwDQotLS0gbGludXgtbWluZS1wcm9t
LWluaXRyZC9hcmNoL21pcHMvc2dpL3Byb20vaW5pdHJkLmMJU3VuIE1heSAx
NyAyMzo0ODoyNSAxOTk4DQoqKioqKioqKioqKioqKioNCioqKiAwICoqKioN
Ci0tLSAxLDM1IC0tLS0NCisgLyoNCisgICogaW5pdHJkLmM6IEluaXRpYWwg
UmFtZGlzayBBUkMgbG9hZGVyDQorICAqDQorICAqIENvcHlyaWdodCAoQykg
MTk5OCBBbGV4IGRlVnJpZXMgPGFkZXZyaWVzQGVuZ3NvYy5jYXJsZXRvbi5j
YT4NCisgICoNCisgICovDQorIA0KKyAjaW5jbHVkZSA8YXNtL3NnaWFsaWIu
aD4NCisgI2luY2x1ZGUgPGFzbS9zZ2lhcmNzLmg+DQorICNpbmNsdWRlIDxs
aW51eC9rZXJuZWwuaD4NCisgI2luY2x1ZGUgImluaXRyZC5oIg0KKyANCisg
aW50IGluaXRyZF9sb2FkICh2b2lkICogaW5pdHJkX3N0YXJ0KSB7DQorIA0K
KyAgICAgICAgIHVuc2lnbmVkIGludCByZXN1bHQ7DQorICAgICAgICAgdW5z
aWduZWQgbG9uZyBzaXplOw0KKyAgICAgICAgIHVuc2lnbmVkIGxvbmcgZmQ7
DQorIA0KKyAgICAgICAgIHByaW50aygiQWR2OiBzdGFydGluZyByZWFkX2lu
aXRyZFxuIik7DQorIA0KKyAgICAgICAgIHJlc3VsdCA9IHByb21fb3Blbihw
cm9tX2luaXRyZF9maWxlbmFtZSxyZG9ubHksJmZkKTsNCisgICAgICAgICBw
cmludGsoIkFkdjogYWZ0ZXIgb3BlbjogJWRcbiIscmVzdWx0KTsNCisgDQor
ICAgICAgICAgcmVzdWx0ID0gcHJvbV9yZWFkKGZkLHByb21faW5pdHJkX3N0
YXJ0LCBwcm9tX2luaXRyZF9zaXplLCZzaXplKTsNCisgDQorICAgICAgICAg
cHJpbnRrKCJBZHY6IGFmdGVyIHJlYWQ6ICVkXG4iLHJlc3VsdCk7DQorICAg
ICAgICAgcHJpbnRrKCJTR0kgUFJPTSBJbml0IFJhbWRpc2sgbG9hZGVkICVs
dSBieXRlcyBvZiAlbHUgb2YgcmFtZGlzayAlcy5cbiIsc2l6ZSxwcm9tX2lu
aXRyZF9zaXplLHByb21faW5pdHJkX2ZpbGVuYW1lKTsNCisgDQorICAgICAg
ICAgcmVzdWx0ID0gcHJvbV9jbG9zZShmZCk7DQorICAgICAgICAgcHJpbnRr
KCJBZHY6IGFmdGVyIGNsb3NlOiAlZFxuIixyZXN1bHQpOw0KKyANCisgDQor
ICAgICAgICAgcmV0dXJuIDE7DQorIA0KKyB9DQpkaWZmIC1OcmMgLXggLmRl
cGVuZCAteCBFbnRyaWVzIGxpbnV4L2FyY2gvbWlwcy9zZ2kvcHJvbS9pbml0
cmQuaCBsaW51eC1taW5lLXByb20taW5pdHJkL2FyY2gvbWlwcy9zZ2kvcHJv
bS9pbml0cmQuaA0KKioqIGxpbnV4L2FyY2gvbWlwcy9zZ2kvcHJvbS9pbml0
cmQuaAlUaHUgSmFuICAxIDAwOjAwOjAwIDE5NzANCi0tLSBsaW51eC1taW5l
LXByb20taW5pdHJkL2FyY2gvbWlwcy9zZ2kvcHJvbS9pbml0cmQuaAlTdW4g
TWF5IDE3IDIzOjUwOjI1IDE5OTgNCioqKioqKioqKioqKioqKg0KKioqIDAg
KioqKg0KLS0tIDEsMzAgLS0tLQ0KKyANCisgI2lmbmRlZiBfU0dJX1BST01f
SU5JVFJEX0gNCisgI2RlZmluZSBfU0dJX1BST01fSU5JVFJEX0gNCisgDQor
IC8qDQorICAqIFBST00gaW5pdCByYW1kaXNrIGludGVyZmFjZXMuDQorICAq
DQorICAqIFRoaXMgZmlsZSBpcyBzdWJqZWN0IHRvIHRoZSB0ZXJtcyBhbmQg
Y29uZGl0aW9ucyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljDQorICAqIExp
Y2Vuc2UuICBTZWUgdGhlIGZpbGUgIkNPUFlJTkciIGluIHRoZSBtYWluIGRp
cmVjdG9yeSBvZiB0aGlzIGFyY2hpdmUNCisgICogZm9yIG1vcmUgZGV0YWls
cy4NCisgICoNCisgICogQ29weXJpZ2h0IChDKSAxOTk1LCAxOTk2IGJ5IEFs
ZXggZGVWcmllcw0KKyAgKg0KKyAgKi8NCisgDQorIC8qIERlZmluZSB0aGUg
ZGVmYXVsdCBpbml0cmQgbWVtb3J5IHNpemUgdG8gYmUgNE1CICovDQorIA0K
KyAjZGVmaW5lIERFRkFVTFRfSU5JVFJEX1NJWkUgNDE5NDMwNA0KKyAjZGVm
aW5lIE1BWF9QUk9NX0lOSVRSRF9GSUxFTkFNRSAyMDANCisgDQorIA0KKyB1
bnNpZ25lZCBsb25nIHByb21faW5pdHJkX3NpemU7DQorIHVuc2lnbmVkIGxv
bmcgcHJvbV9pbml0cmRfc3RhcnQ7DQorIGNoYXIgcHJvbV9pbml0cmRfZmls
ZW5hbWVbTUFYX1BST01fSU5JVFJEX0ZJTEVOQU1FXTsNCisgaW50IHByb21f
aW5pdHJkX2xvYWQgKHZvaWQgKiBpbml0cmRfc3RhcnQpOw0KKyANCisgZXh0
ZXJuIGludCByZF9pbWFnZV9zdGFydDsNCisgDQorICNlbmRpZg0KKyANCmRp
ZmYgLU5yYyAteCAuZGVwZW5kIC14IEVudHJpZXMgbGludXgvYXJjaC9taXBz
L3NnaS9wcm9tL21lbW9yeS5jIGxpbnV4LW1pbmUtcHJvbS1pbml0cmQvYXJj
aC9taXBzL3NnaS9wcm9tL21lbW9yeS5jDQoqKiogbGludXgvYXJjaC9taXBz
L3NnaS9wcm9tL21lbW9yeS5jCU1vbiBNYXkgMTggMTc6MTY6MzggMTk5OA0K
LS0tIGxpbnV4LW1pbmUtcHJvbS1pbml0cmQvYXJjaC9taXBzL3NnaS9wcm9t
L21lbW9yeS5jCU1vbiBNYXkgMTggMDA6MDM6NDYgMTk5OA0KKioqKioqKioq
KioqKioqDQoqKiogMTgsMjMgKioqKg0KLS0tIDE4LDI1IC0tLS0NCiAgI2lu
Y2x1ZGUgPGFzbS9wZ3RhYmxlLmg+DQogICNpbmNsdWRlIDxhc20vYm9vdGlu
Zm8uaD4NCiAgDQorICNpbmNsdWRlICJpbml0cmQuaCINCisgDQogIC8qICNk
ZWZpbmUgREVCVUcgKi8NCiAgDQogIF9faW5pdGZ1bmMoc3RydWN0IGxpbnV4
X21kZXNjICpwcm9tX2dldG1kZXNjKHN0cnVjdCBsaW51eF9tZGVzYyAqY3Vy
cikpDQoqKioqKioqKioqKioqKioNCioqKiA2OCw3MyAqKioqDQotLS0gNzAs
NzcgLS0tLQ0KICAJaW50IHRvdHJhbTsNCiAgCWludCBpID0gMDsNCiAgDQor
IAlzdHJ1Y3QgbGludXhfbWRlc2MgKmluaXRyZF9wID0gTlVMTDsNCisgDQog
IAlwID0gcHJvbV9nZXRtZGVzYyhQUk9NX05VTExfTURFU0MpOw0KICAjaWZk
ZWYgREVCVUcNCiAgCXByb21fcHJpbnRmKCJBUkNTIE1FTU9SWSBERVNDUklQ
VE9SIGR1bXA6XG4iKTsNCioqKioqKioqKioqKioqKg0KKioqIDkyLDk3ICoq
KioNCi0tLSA5NiwxMDYgLS0tLQ0KICAJCQkJICAgIGksIHByb21fcGJsb2Nr
c1tpXS5iYXNlLA0KICAJCQkJICAgIHByb21fcGJsb2Nrc1tpXS5zaXplKTsN
CiAgI2VuZGlmDQorIA0KKyAgICAgICAgICAgICAgICAgICAgICAgICAvKiBy
ZW1lbWJlciB0aGUgbGFzdCBibG9jayAqLw0KKyAgICAgICAgICAgICAgICAg
ICAgICAgICBpZiAocHJvbV9pbml0cmRfc2l6ZSA8PXByb21fcGJsb2Nrc1tp
XS5zaXplKSB7DQorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
aW5pdHJkX3A9cDsNCisgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAJ
CQlpKys7DQogIAkJfQ0KICAJCXAgPSBwcm9tX2dldG1kZXNjKHApOw0KKioq
KioqKioqKioqKioqDQoqKiogMTAwLDEwNSAqKioqDQotLS0gMTA5LDEyNCAt
LS0tDQogIAlwcm9tX3BibG9ja3NbaV0uc2l6ZSA9IDA7IC8qIGluZGljYXRl
cyBsYXN0IGVsZW0uIG9mIGFycmF5ICovDQogIAlwcmludGsoIlBST01MSUI6
IFRvdGFsIGZyZWUgcmFtICVkIGJ5dGVzICglZEssJWRNQilcbiIsDQogIAkJ
ICAgIHRvdHJhbSwgKHRvdHJhbS8xMDI0KSwgKHRvdHJhbS8xMDI0LzEwMjQp
KTsNCisgDQorICAgICAgICAgaWYgKGluaXRyZF9wICE9IE5VTEwpIHsNCisg
CQlpbml0cmRfcC0+dHlwZSA9IGFwZXJtOw0KKyAgICAgICAgICAgICAgICAg
cmRfaW1hZ2Vfc3RhcnQgPSAoaW50KSBpbml0cmRfcC0+YmFzZTsNCisgICAg
ICAgICAgICAgICAgIHByaW50aygiUHV0dGluZyBpbml0cmQgYXQgJWRcbiIs
cmRfaW1hZ2Vfc3RhcnQpOw0KKyAgICAgICAgIH0gZWxzZSB7DQorICAgICAg
ICAgICAgICAgICBwcmludGsoIkNhbm5vdCBmaW5kICV1bGQgY29udGlndW91
cyBmcmVlIGJ5dGVzICINCisgICAgICAgICAgICAgICAgICAgICAgICAiZm9y
IHRoZSByYW1kaXNrXG4iLHByb21faW5pdHJkX3NpemUpOw0KKyAgICAgICAg
ICAgICAgICAgcmRfaW1hZ2Vfc3RhcnQgPSAwOw0KKyAgICAgICAgfQ0KICAN
CiAgCS8qIFNldHVwIHVwcGVyIHBoeXNpY2FsIG1lbW9yeSBib3VuZC4gKi8N
CiAgCXByb21fc2V0dXBfbWVtdXBwZXIoKTsNCg==
--1971722821-1405645646-895528193=:20171--

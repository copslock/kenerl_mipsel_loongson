Received: with ECARTIS (v1.0.0; list linux-mips); Fri, 19 Dec 2003 04:14:49 +0000 (GMT)
Received: from ns10.iosnet.ne.jp ([IPv6:::ffff:211.127.181.3]:8200 "HELO
	ns10.iodata.co.jp") by linux-mips.org with SMTP id <S8224939AbTLSEOr>;
	Fri, 19 Dec 2003 04:14:47 +0000
Received: (qmail 33092 invoked from network); 19 Dec 2003 04:14:33 -0000
Received: from fw40.iodata.jp (HELO isl50.iodata.co.jp) (fwuser@211.127.181.2)
  by ns10.iodata.jp with SMTP; 19 Dec 2003 04:14:33 -0000
Date: Fri, 19 Dec 2003 13:14:31 +0900
Message-ID: <m3zndpsau0.wl@iodata.jp>
From: Kunihiko IMAI <kimai@iodata.jp>
To: linux-mips@linux-mips.org
Subject: Re: USB on MIPS
In-Reply-To: <20031218094321.A4146@mvista.com>
References: <BAY7-F37p6I65awhyxk00043bd8@hotmail.com>
MIME-Version: 1.0 (generated by SEMI 1.14.3 - =?ISO-2022-JP?B?IhskQjVtGyhC?=
 =?ISO-2022-JP?B?GyRCJU5DKxsoQiI=?=)
Content-Type: text/plain; charset=US-ASCII
Return-Path: <kimai@iodata.jp>
X-Envelope-To: <"|/home/ecartis/ecartis -s linux-mips"> (uid 0)
X-Orcpt: rfc822;linux-mips@linux-mips.org
Original-Recipient: rfc822;linux-mips@linux-mips.org
X-archive-position: 3797
X-ecartis-version: Ecartis v1.0.0
Sender: linux-mips-bounce@linux-mips.org
Errors-to: linux-mips-bounce@linux-mips.org
X-original-sender: kimai@iodata.jp
Precedence: bulk
X-list: linux-mips

Hi,

At Thu, 18 Dec 2003 09:43:21 -0800,
Jun Sun wrote:
> 
> On Thu, Dec 18, 2003 at 07:58:36PM +0530, samavarthy c wrote:
> > Hi,
(snip)
> 
> Another possiblity (which is probably more likely) is the IRQ
> number is not seupt correctly.  

And another possibilities are:

	DMA cache coherency
		NEC VR4xxxs have no bus-snoop function. So
		cache-coherency must be maintaind by software.
		(or use KSEG1 access)

		But I remember linux-2.4.18 of usb-ohci.c doesn't have
		this problem.

	Read/write cycle order
		Read/write cycle order of CPU instruction level is
		guaranteed at bus level?
		( Or at assembler level, the sequent instruction is
		re-ordered ? )

		Newer version of usb-ohci.c has some wmb() funtions.
		It synchronizes read/write order.

I got similar errors on VR4181A with 2.4.18 kernel.  VR4181A has
built-in USB OHCI 1.1 host connected internal PCI bus.

To fix this problem, I compared newer usb-ohci.c and put wmb()
corresponded place. It is expaneded as subsequent NOPs. (VR4xxx has
real SYNC instruction.)

Thanks.
_._. __._  _ . ... _  .___ ._. _____ _... ._ _._ _.._. .____  _ . ... _

                                                          Kunihiko IMAI

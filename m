Received: (from majordomo@localhost)
	by oss.sgi.com (8.11.2/8.11.3) id g15DmO228987
	for linux-mips-outgoing; Tue, 5 Feb 2002 05:48:24 -0800
Received: from surveyor.mars.org (surveyor.mars.org [216.98.134.66])
	by oss.sgi.com (8.11.2/8.11.3) with SMTP id g15DmIA28955
	for <linux-mips@oss.sgi.com>; Tue, 5 Feb 2002 05:48:18 -0800
Received: from mars.org (localhost [127.0.0.1])
	by surveyor.mars.org (8.9.3/8.9.3/Debian 8.9.3-21) with ESMTP id FAA32122;
	Tue, 5 Feb 2002 05:48:15 -0800
Message-Id: <200202051348.FAA32122@surveyor.mars.org>
From: Rob Leslie <rob@mars.org>
To: Pete Popov <ppopov@mvista.com>
Cc: linux-mips@oss.sgi.com
Subject: Re: madplay on mips
In-reply-to: Your message of "04 Feb 2002 10:46:54 PST."
	<1012848414.15163.140.camel@zeus>
Mime-Version: 1.0 (generated by tm-edit 7.106)
Content-Type: text/plain; charset=US-ASCII
Date: Tue, 05 Feb 2002 05:48:15 -0800
Sender: owner-linux-mips@oss.sgi.com
Precedence: bulk

Pete Popov wrote:
> Has anyone used madplay on mips to play mp3 files successfully? I've
> tried it on two mips boards with different sound drivers, and in both
> cases it plays the song slower and a bit muffled.  It works on x86 and
> supposedly ppc.

Muffled sound could be the result of a poor FPM choice, or a buggy compiler.

For best performance, MAD needs a multiply/accumulate instruction, which is
not available on all MIPS platforms. Check the MIPS section of libmad/fixed.h
and see whether you can use either of the MADD_ASM alternatives, then change
your libmad/config.h to suit (or consider updating libmad/configure.in). In
the worst case you might need to write a new asm alternative, or try something
more generic like FPM_64BIT or FPM_DEFAULT -- though the latter could also be
the cause of poor sound.

I've encountered problems with certain gcc optimization options on some
platforms, notably ARM and MIPS, the symptom being a sort of muffled sound
result rather than the clear sound MAD ought to produce. I never traced these
bugs in the compiler, so my only advice is to try different combinations of
-fstrength-reduce and -finline-functions if you suspect this to be a problem.

> Even though madplay claims that no floating point is used, the
> disassembly of the latest version shows otherwise. But I tried it on a
> board with a cpu that does have a hardware floating point unit with the
> same result.

The _only_ floating point used by madplay is in option parsing and calculation
of peak amplitude in decibels upon completion of decoding. There is no
floating point used in the decoder proper (libmad).

I'm not sure what you mean by songs "playing slower" but it could be either
libmad is not reaching real-time performance, or there could be issues with
channel/sampling frequency selection in your sound driver. You could try -m
and/or --downsample, or modify the audio output module to use a fixed known
good sampling frequency. Also try sending output to a file (-o out.wav) and
see if you can play that successfully with another program.

If the problem is real-time performance, you can try the --enable-speed option
to `configure' at the expense of some accuracy.

-- 
Rob Leslie
rob@mars.org

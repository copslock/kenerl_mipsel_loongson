Received: with ECARTIS (v1.0.0; list linux-mips); Thu, 25 May 2006 08:06:05 +0200 (CEST)
Received: from web38415.mail.mud.yahoo.com ([209.191.125.46]:6793 "HELO
	web38415.mail.mud.yahoo.com") by ftp.linux-mips.org with SMTP
	id S8133464AbWEYGF4 (ORCPT <rfc822;linux-mips@linux-mips.org>);
	Thu, 25 May 2006 08:05:56 +0200
Received: (qmail 33747 invoked by uid 60001); 25 May 2006 06:05:48 -0000
DomainKey-Signature: a=rsa-sha1; q=dns; c=nofws;
  s=s1024; d=yahoo.com;
  h=Message-ID:Received:Date:From:Subject:To:Cc:In-Reply-To:MIME-Version:Content-Type:Content-Transfer-Encoding;
  b=q/Xk0qZe4wxlIP1Byn7w4IcvWWsYMVKhb3MHsrlocRxwiq44vdt0YBlpIxiiaFqUl6iEUmrOFYnFNDuF+wjPZ7V5SSWsPZVS6TnZGthlfcE2D2w2TUSUgw4GhqsCVgy06pLfhx2cuNPCdiNlNKxFb4YizQHSSt1rpBnNjd9RuuY=  ;
Message-ID: <20060525060548.33745.qmail@web38415.mail.mud.yahoo.com>
Received: from [203.92.57.132] by web38415.mail.mud.yahoo.com via HTTP; Wed, 24 May 2006 23:05:48 PDT
Date:	Wed, 24 May 2006 23:05:48 -0700 (PDT)
From:	ashley jones <ashley_jones_2000@yahoo.com>
Subject: Re: Can't debug core files with GDB
To:	Tony Lin <lin.tony@gmail.com>
Cc:	Daniel Jacobowitz <dan@debian.org>, linux-mips@linux-mips.org
In-Reply-To: <404548f40605241844y41b897b6sb8a7512feb8655f6@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="0-1011827711-1148537148=:32493"
Content-Transfer-Encoding: 8bit
Return-Path: <ashley_jones_2000@yahoo.com>
X-Envelope-To: <"|/home/ecartis/ecartis -s linux-mips"> (uid 0)
X-Orcpt: rfc822;linux-mips@linux-mips.org
Original-Recipient: rfc822;linux-mips@linux-mips.org
X-archive-position: 11548
X-ecartis-version: Ecartis v1.0.0
Sender: linux-mips-bounce@linux-mips.org
Errors-to: linux-mips-bounce@linux-mips.org
X-original-sender: ashley_jones_2000@yahoo.com
Precedence: bulk
X-list: linux-mips

--0-1011827711-1148537148=:32493
Content-Type: text/plain; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

   check out  "google coredumper"  it is an opensource coredump utlity. 
   
  Regards,
  A'Jones.

Tony Lin <lin.tony@gmail.com> wrote:
  I've pretty much concluded the gdb is not at fault. Loading a coredump
generated by another mips-linux system, it was able to read the
registers correctly and lookup the program counter.

So the problem now is my 32-bit mips-linux is generating core files in
a different format than what gdb expects. I've been digging into
fs/exec.c and fs/binfmt_elf.c without much success. Are there
documents describing the expected coredump header format?

I'm not really familiar with the register terminology (fpu? xfpregs?)
so am having some trouble figuring out where linux write the program
counter into the core dump.

Thanks for all your help,
- Tony


On 5/24/06, ashley jones wrote:
>
> hi,
> where are you running your GDB ? on i386 ? then i guess you shouldnt
> specify --host=mips-linux. just run .configure script and specify only
> target as mips-linux.
>
> Regards,
> A'Jones.
>
>
>
> Tony Lin 
wrote:
>
> Objdump didn't yield any useful information, perhaps I didn't set the
> flags correctly to show all the private registers.
>
> You may be right about the kernel generated core file though. I
> checked the registerd in gdb, everything looks good except the program
> counter was zero. I then modified the mips kernel to spit out the
> registers when doing the coredump. A valid pc (0x4008c0) was there
> when doing fs/exec.c:do_coredump()
>
> printks from do_coredump()
> -----------
> bash-2.05a# killall -SIGSEGV nebtest
> 1:<6>
>
> printing contents of pt_regs *regs
> 1:<6>cp0_status 0xdc13
> 1:<6>lo 0x0
> 1:<6>hi 0x0
> 1:<6>cp0_badvaddr 0x803fbda0
> 1:<6>cp0_cause 0x10801000
> 1:<6>cp0_epc 0x4008c0
>
>
> Calling 'info registers' in gdb coredump
> ----------------------
> Reading symbols from /lib/ld.so.1...done.
> Loaded symbols for /lib/ld.so.1
> #0 0x00000000 in ?? ()
> (gdb) info registers
> zero at v0 v1 a0 a1 a2 a3
> R0 00000000 1000dc00 0000000f 00000000 0000000f 2aac1000 0000000f 00000000
> t0 t1 t2 t3 t4 t5 t6 t7
> R8 00000000 00000001 00000003 49276d20 68697320 00000000 00000000 7468656e
> s0 s1 s2 s3 s4 s5 s6 s7
> R16 2ab00230 7fff7e64 2ad09f50 004008d0 00000001 004007dc 00000000 1001f328
> t8 t9 k0 k1 gp sp s8 ra
> R24 00000003 00000000 fbad2a84 00000000 10008040 7fff7de0 7fff7de0 00400898
> sr lo hi bad cause pc
> 10801000 0000dc13 00000000 803fbda0 004008c0 00000000
> fsr fir
> 00000000 00000000
> (gdb)
>
> (gdb) x/32 0x4008c0
> 0x4008c0 : 0x1000ffff 0x00000000 0x00000000
>
> 0x00000000
> 0x4008d0 <__libc_csu_init>: 0x3c1c0fc0 0x279c7770
> 0x0399e021 0x27bdffd8
> 0x4008e0 <__libc_csu_init+16>: 0xafbf0020 0xafb1001c
> 0xafb00018 0xafbc0010
> 0x4008f0 <__libc_csu_init+32>: 0x8f998054 0x00000000
> 0x0320f809 0x00000000
> 0x400900 <__libc_csu_init+48>: 0x8fbc0010 0x8f838034
> 0x8f828040 0x00431023
>
>
>
> The 0x4008c0 address doesn't look half bad, pointing within main(). So
> it looks like the mips kernel had all the right registers values but
> just didn't format it correctly in the core dump? It wrote the pc into
> cause, cause into sr, and cp0_status into lo.
>
>
> Thanks much,
> - Tony
>
> On 5/17/06, Daniel Jacobowitz wrote:
> > Check the contents of the core file with objdump? I recall seeing at
> > least one recent MIPS kernel which failed to save registers. Take a
> > look at the .reg section.
> >
> > --
> > Daniel Jacobowitz
> > CodeSourcery
> >
>
>
>
>
>
> ________________________________
> How low will we go? Check out Yahoo! Messenger's low PC-to-Phone call rates.
>
>



		
---------------------------------
Talk is cheap. Use Yahoo! Messenger to make PC-to-Phone calls.  Great rates starting at 1&cent;/min.
--0-1011827711-1148537148=:32493
Content-Type: text/html; charset=iso-8859-1
Content-Transfer-Encoding: 8bit

<div>&nbsp;&nbsp;&nbsp;check out &nbsp;"google coredumper"&nbsp; it is&nbsp;an opensource coredump utlity. </div>  <div>&nbsp;</div>  <div>Regards,</div>  <div>A'Jones.<BR><BR><B><I>Tony Lin &lt;lin.tony@gmail.com&gt;</I></B> wrote:</div>  <BLOCKQUOTE class=replbq style="PADDING-LEFT: 5px; MARGIN-LEFT: 5px; BORDER-LEFT: #1010ff 2px solid">I've pretty much concluded the gdb is not at fault. Loading a coredump<BR>generated by another mips-linux system, it was able to read the<BR>registers correctly and lookup the program counter.<BR><BR>So the problem now is my 32-bit mips-linux is generating core files in<BR>a different format than what gdb expects. I've been digging into<BR>fs/exec.c and fs/binfmt_elf.c without much success. Are there<BR>documents describing the expected coredump header format?<BR><BR>I'm not really familiar with the register terminology (fpu? xfpregs?)<BR>so am having some trouble figuring out where linux write the program<BR>counter into the core
 dump.<BR><BR>Thanks for all your help,<BR>- Tony<BR><BR><BR>On 5/24/06, ashley jones <ASHLEY_JONES_2000@YAHOO.COM>wrote:<BR>&gt;<BR>&gt; hi,<BR>&gt; where are you running your GDB ? on i386 ? then i guess you shouldnt<BR>&gt; specify --host=mips-linux. just run .configure script and specify only<BR>&gt; target as mips-linux.<BR>&gt;<BR>&gt; Regards,<BR>&gt; A'Jones.<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; Tony Lin <LIN.TONY@GMAIL.COM>wrote:<BR>&gt;<BR>&gt; Objdump didn't yield any useful information, perhaps I didn't set the<BR>&gt; flags correctly to show all the private registers.<BR>&gt;<BR>&gt; You may be right about the kernel generated core file though. I<BR>&gt; checked the registerd in gdb, everything looks good except the program<BR>&gt; counter was zero. I then modified the mips kernel to spit out the<BR>&gt; registers when doing the coredump. A valid pc (0x4008c0) was there<BR>&gt; when doing fs/exec.c:do_coredump()<BR>&gt;<BR>&gt; printks from do_coredump()<BR>&gt;
 -----------<BR>&gt; bash-2.05a# killall -SIGSEGV nebtest<BR>&gt; 1:&lt;6&gt;<BR>&gt;<BR>&gt; printing contents of pt_regs *regs<BR>&gt; 1:&lt;6&gt;cp0_status 0xdc13<BR>&gt; 1:&lt;6&gt;lo 0x0<BR>&gt; 1:&lt;6&gt;hi 0x0<BR>&gt; 1:&lt;6&gt;cp0_badvaddr 0x803fbda0<BR>&gt; 1:&lt;6&gt;cp0_cause 0x10801000<BR>&gt; 1:&lt;6&gt;cp0_epc 0x4008c0<BR>&gt;<BR>&gt;<BR>&gt; Calling 'info registers' in gdb coredump<BR>&gt; ----------------------<BR>&gt; Reading symbols from /lib/ld.so.1...done.<BR>&gt; Loaded symbols for /lib/ld.so.1<BR>&gt; #0 0x00000000 in ?? ()<BR>&gt; (gdb) info registers<BR>&gt; zero at v0 v1 a0 a1 a2 a3<BR>&gt; R0 00000000 1000dc00 0000000f 00000000 0000000f 2aac1000 0000000f 00000000<BR>&gt; t0 t1 t2 t3 t4 t5 t6 t7<BR>&gt; R8 00000000 00000001 00000003 49276d20 68697320 00000000 00000000 7468656e<BR>&gt; s0 s1 s2 s3 s4 s5 s6 s7<BR>&gt; R16 2ab00230 7fff7e64 2ad09f50 004008d0 00000001 004007dc 00000000 1001f328<BR>&gt; t8 t9 k0 k1 gp sp s8 ra<BR>&gt; R24 00000003
 00000000 fbad2a84 00000000 10008040 7fff7de0 7fff7de0 00400898<BR>&gt; sr lo hi bad cause pc<BR>&gt; 10801000 0000dc13 00000000 803fbda0 004008c0 00000000<BR>&gt; fsr fir<BR>&gt; 00000000 00000000<BR>&gt; (gdb)<BR>&gt;<BR>&gt; (gdb) x/32 0x4008c0<BR>&gt; 0x4008c0 : 0x1000ffff 0x00000000 0x00000000<BR>&gt;<BR>&gt; 0x00000000<BR>&gt; 0x4008d0 &lt;__libc_csu_init&gt;: 0x3c1c0fc0 0x279c7770<BR>&gt; 0x0399e021 0x27bdffd8<BR>&gt; 0x4008e0 &lt;__libc_csu_init+16&gt;: 0xafbf0020 0xafb1001c<BR>&gt; 0xafb00018 0xafbc0010<BR>&gt; 0x4008f0 &lt;__libc_csu_init+32&gt;: 0x8f998054 0x00000000<BR>&gt; 0x0320f809 0x00000000<BR>&gt; 0x400900 &lt;__libc_csu_init+48&gt;: 0x8fbc0010 0x8f838034<BR>&gt; 0x8f828040 0x00431023<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; The 0x4008c0 address doesn't look half bad, pointing within main(). So<BR>&gt; it looks like the mips kernel had all the right registers values but<BR>&gt; just didn't format it correctly in the core dump? It wrote the pc into<BR>&gt; cause,
 cause into sr, and cp0_status into lo.<BR>&gt;<BR>&gt;<BR>&gt; Thanks much,<BR>&gt; - Tony<BR>&gt;<BR>&gt; On 5/17/06, Daniel Jacobowitz wrote:<BR>&gt; &gt; Check the contents of the core file with objdump? I recall seeing at<BR>&gt; &gt; least one recent MIPS kernel which failed to save registers. Take a<BR>&gt; &gt; look at the .reg section.<BR>&gt; &gt;<BR>&gt; &gt; --<BR>&gt; &gt; Daniel Jacobowitz<BR>&gt; &gt; CodeSourcery<BR>&gt; &gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt;<BR>&gt; ________________________________<BR>&gt; How low will we go? Check out Yahoo! Messenger's low PC-to-Phone call rates.<BR>&gt;<BR>&gt;<BR><BR></BLOCKQUOTE><BR><p>
		<hr size=1>Talk is cheap. Use Yahoo! Messenger to make PC-to-Phone calls. <a href="http://us.rd.yahoo.com/mail_us/taglines/postman7/*http://us.rd.yahoo.com/evt=39666/*http://messenger.yahoo.com"> Great rates starting at 1&cent;/min.
--0-1011827711-1148537148=:32493--

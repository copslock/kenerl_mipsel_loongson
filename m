Received: from oss.sgi.com (localhost [127.0.0.1])
	by oss.sgi.com (8.12.3/8.12.3) with ESMTP id g61JR8nC017024
	for <linux-mips-outgoing@oss.sgi.com>; Mon, 1 Jul 2002 12:27:08 -0700
Received: (from majordomo@localhost)
	by oss.sgi.com (8.12.3/8.12.3/Submit) id g61JR84g017023
	for linux-mips-outgoing; Mon, 1 Jul 2002 12:27:08 -0700
X-Authentication-Warning: oss.sgi.com: majordomo set sender to owner-linux-mips@oss.sgi.com using -f
Received: from laposte.enst-bretagne.fr (laposte.enst-bretagne.fr [192.108.115.3])
	by oss.sgi.com (8.12.3/8.12.3) with SMTP id g61JPdnC016943;
	Mon, 1 Jul 2002 12:25:39 -0700
Received: from resel.enst-bretagne.fr (UNKNOWN@maisel-gw.enst-bretagne.fr [192.44.76.8])
	by laposte.enst-bretagne.fr (8.11.6/8.11.6) with ESMTP id g61JTKC25499;
	Mon, 1 Jul 2002 21:29:20 +0200
Received: from melkor (mail@melkor.maisel.enst-bretagne.fr [172.16.20.65])
	by resel.enst-bretagne.fr (8.12.3/8.12.3/Debian -4) with ESMTP id g61JTKTF008090;
	Mon, 1 Jul 2002 21:29:20 +0200
Received: from glaurung (helo=localhost)
	by melkor with local-esmtp (Exim 3.35 #1 (Debian))
	id 17P6rQ-0007FW-00; Mon, 01 Jul 2002 21:29:20 +0200
Date: Mon, 1 Jul 2002 21:29:20 +0200 (CEST)
From: Vivien Chappelier <vivien.chappelier@enst-bretagne.fr>
X-Sender: glaurung@melkor
To: Ralf Baechle <ralf@oss.sgi.com>
cc: linux-mips@oss.sgi.com
Subject: [PATCH] O2 ethernet support
Message-ID: <Pine.LNX.4.21.0207012123160.27848-200000@melkor>
MIME-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="279724308-970882123-1025551760=:27848"
X-Virus-Scanned: by amavisd-milter (http://amavis.org/) at enst-bretagne.fr
X-Spam-Status: No, hits=0.2 required=5.0 tests=MIME_NULL_BLOCK version=2.20
X-Spam-Level: 
Sender: owner-linux-mips@oss.sgi.com
Precedence: bulk

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.
  Send mail to mime@docserver.cac.washington.edu for more info.

--279724308-970882123-1025551760=:27848
Content-Type: TEXT/PLAIN; charset=US-ASCII

Hi,

	Here is a patch to fix the SGI O2 onboard ethernet driver, which
was not working at all. It also adds support for autodetection of 10Mbps
or 100Mbps link.

Known remaining issues:
	* sometimes hangs under heavy load (rare)

	Please comment and/or apply.

regards,
Vivien Chappelier.

--279724308-970882123-1025551760=:27848
Content-Type: TEXT/plain; name="linux-O2-meth.diff"
Content-Transfer-Encoding: BASE64
Content-ID: <Pine.LNX.4.21.0207012129200.27848@melkor>
Content-Description: 
Content-Disposition: attachment; filename="linux-O2-meth.diff"

LS0tIGxpbnV4L2RyaXZlcnMvbmV0L21ldGguYwlUaHUgRGVjIDIwIDE4OjMw
OjUxIDIwMDENCisrKyBsaW51eC5idWlsZC9kcml2ZXJzL25ldC9tZXRoLmMJ
VHVlIEphbiAyMiAxNjo1MTowMiAyMDAyDQpAQCAtMSw1ICsxLDUgQEANCiAv
Kg0KLSAqIG1ldGguYyAtLSBPMiBCdWlsdGluIDEwLzEwMCBFdGhlcm5ldCBk
cml2ZXIsIHRoYXQgZG9lc24ndCB3b3JrIGF0IHRoZSBtb21lbnQNCisgKiBt
ZXRoLmMgLS0gTzIgQnVpbHRpbiAxMC8xMDAgRXRoZXJuZXQgZHJpdmVyDQog
ICoNCiAgKiBDb3B5cmlnaHQgKEMpIDIwMDEgSWx5YSBWb2x5bmV0cw0KICAq
DQpAQCAtMTgsNyArMTgsNyBAQA0KICNlbmRpZg0KIA0KICNpZiBNRkVfREVC
VUc+PTENCi0jZGVmaW5lIERQUklOVEsoc3RyLGFyZ3MuLi4pIHByaW50ayAo
S0VSTl9ERUJVRyAibWV0aDogJXM6ICIgc3RyLCBfX0ZVTkNUSU9OX18gLCAj
IyBhcmdzKQ0KKyNkZWZpbmUgRFBSSU5USyhzdHIsYXJncy4uLikgcHJpbnRr
IChLRVJOX0RFQlVHICJtZXRoKCVsZCk6ICVzOiAiIHN0ciwgamlmZmllcywg
X19GVU5DVElPTl9fICwgIyMgYXJncykNCiAjZGVmaW5lIE1GRV9SWF9ERUJV
RyAyDQogI2Vsc2UNCiAjZGVmaW5lIERQUklOVEsoc3RyLGFyZ3MuLi4pDQpA
QCAtNjQsMTIgKzY0LDE2IEBADQogLyogVGhpcyBpcyBhIGxvYWQtdGltZSBv
cHRpb25zICovDQogLypzdGF0aWMgaW50IGV0aCA9IDA7DQogTU9EVUxFX1BB
Uk0oZXRoLCAiaSIpOyovDQotLyoNCisNCisjZGVmaW5lIEhBVkVfVFhfVElN
RU9VVA0KKy8qIFRoZSBtYXhpbXVtIHRpbWUgd2FpdGVkIChpbiBqaWZmaWVz
KSBiZWZvcmUgYXNzdW1pbmcgYSBUeCBmYWlsZWQuICg0MDBtcykgKi8NCisj
ZGVmaW5lIFRYX1RJTUVPVVQgKDQwMCpIWi8xMDAwKQ0KKw0KICNpZmRlZiBI
QVZFX1RYX1RJTUVPVVQNCi1zdGF0aWMgaW50IHRpbWVvdXQgPSAwOw0KK3N0
YXRpYyBpbnQgdGltZW91dCA9IFRYX1RJTUVPVVQ7DQogTU9EVUxFX1BBUk0o
dGltZW91dCwgImkiKTsNCiAjZW5kaWYNCi0qLw0KKw0KIGludCBtZXRoX2V0
aDsNCiANCiANCkBAIC04OSw2ICs5Myw3IEBADQogCXN0cnVjdCBza19idWZm
ICp0eF9za2JzW1RYX1JJTkdfRU5UUklFU107DQogCWRtYV9hZGRyX3QgICAg
ICB0eF9za2JfZG1hc1tUWF9SSU5HX0VOVFJJRVNdOw0KIAlpbnQgdHhfcmVh
ZCx0eF93cml0ZTsNCisJaW50IHR4X2NvdW50Ow0KIA0KIAlyeF9wYWNrZXQg
KnJ4X3JpbmdbUlhfUklOR19FTlRSSUVTXTsNCiAJZG1hX2FkZHJfdCByeF9y
aW5nX2RtYXNbUlhfUklOR19FTlRSSUVTXTsNCkBAIC0xMDUsNyArMTEwLDcg
QEANCiBjaGFyIG8ybWV0aF9lYWRkcls4XT17MCwwLDAsMCwwLDAsMCwwfTsN
CiANCiBzdGF0aWMgaW5saW5lIHZvaWQgbG9hZF9lYWRkcihzdHJ1Y3QgbmV0
X2RldmljZSAqZGV2LA0KLQkJCQkgICB2b2xhdGlsZSBzdHJ1Y3QgbWV0aF9y
ZWdzICpyZWdzKQ0KKwkJCSAgICAgIHZvbGF0aWxlIHN0cnVjdCBtZXRoX3Jl
Z3MgKnJlZ3MpDQogew0KIAlpbnQgaTsNCiAJRFBSSU5USygiTG9hZGluZyBN
QUMgQWRkcmVzczogJTAyeDolMDJ4OiUwMng6JTAyeDolMDJ4OiUwMnhcbiIs
DQpAQCAtMTQ4LDEzICsxNTMsMTMgQEANCiAJdm9sYXRpbGUgbWV0aF9yZWdz
KiByZWdzPXByaXYtPnJlZ3M7DQogCWludCBydmFsOw0KIC8vLwlEUFJJTlRL
KCJUcnlpbmcgdG8gd3JpdGUgdmFsdWUgJWkgdG8gcmVndXN0ZXIgJWlcbiIs
dmFsLCBwZnlyZWcpOw0KLS8vLwlzcGluX2xvY2tfaXJxKCZwcml2LT5tZXRo
X2xvY2spOw0KKwlzcGluX2xvY2tfaXJxKCZwcml2LT5tZXRoX2xvY2spOw0K
IAlXQUlUX0ZPUl9QSFkocmVncyxydmFsKQ0KIAlyZWdzLT5waHlfcmVnaXN0
ZXJzPShwcml2LT5waHlfYWRkcjw8NSl8KHBmeXJlZyYweDFmKTsNCiAJcmVn
cy0+cGh5X2RhdGE9dmFsOw0KIAl1ZGVsYXkoMjUpOw0KIAlXQUlUX0ZPUl9Q
SFkocmVncyxydmFsKQ0KLS8vLwlzcGluX3VubG9ja19pcnEoJnByaXYtPm1l
dGhfbG9jayk7DQorCXNwaW5fdW5sb2NrX2lycSgmcHJpdi0+bWV0aF9sb2Nr
KTsNCiB9DQogDQogLyogTW9kaWZ5IHBoeSByZWdpc3RlciB1c2luZyBnaXZl
biBtYXNrIGFuZCB2YWx1ZSAqLw0KQEAgLTE3OSw3ICsxODQsNyBAQA0KIAkv
KiBjaGVjayBpZiBwaHkgaXMgZGV0ZWN0ZWQgYWxyZWFkeSAqLw0KIAlpZihw
cml2LT5waHlfYWRkcj49MCYmcHJpdi0+cGh5X2FkZHI8MzIpDQogCQlyZXR1
cm4gMDsNCi0Jc3Bpbl9sb2NrX2lycShwcml2LT5tZXRoX2xvY2spOw0KKwlz
cGluX2xvY2tfaXJxKCZwcml2LT5tZXRoX2xvY2spOw0KIAlmb3IgKGk9MDtp
PDMyOysraSl7DQogCQlwcml2LT5waHlfYWRkcj0oY2hhcilpOw0KIAkJcDI9
bWRpb19yZWFkKHByaXYsMik7DQpAQCAtMjA1LDcgKzIxMCw3IEBADQogCQkJ
YnJlYWs7DQogCQl9DQogCX0NCi0Jc3Bpbl91bmxvY2tfaXJxKHByaXYtPm1l
dGhfbG9jayk7DQorCXNwaW5fdW5sb2NrX2lycSgmcHJpdi0+bWV0aF9sb2Nr
KTsNCiAJaWYocHJpdi0+cGh5X2FkZHI8MzIpIHsNCiAJCXJldHVybiAwOw0K
IAl9DQpAQCAtMjE0LDE3ICsyMTksNTQgQEANCiAJcmV0dXJuIC1FTk9ERVY7
DQogfQ0KIA0KK3N0YXRpYyB2b2lkIG1ldGhfY2hlY2tfbGluayhzdHJ1Y3Qg
bmV0X2RldmljZSAqZGV2KQ0KK3sNCisJc3RydWN0IG1ldGhfcHJpdmF0ZSAq
cHJpdiA9IChzdHJ1Y3QgbWV0aF9wcml2YXRlICopIGRldi0+cHJpdjsNCisJ
aW50IG1paV9wYXJ0bmVyID0gbWRpb19yZWFkKHByaXYsIDUpOw0KKwlpbnQg
bWlpX2FkdmVydGlzaW5nID0gbWRpb19yZWFkKHByaXYsIDQpOw0KKwlpbnQg
bmVnb3RpYXRlZCA9IG1paV9hZHZlcnRpc2luZyAmIG1paV9wYXJ0bmVyOw0K
KwlpbnQgZHVwbGV4LCBzcGVlZDsNCisNCisJaWYgKG1paV9wYXJ0bmVyID09
IDB4ZmZmZikNCisJCXJldHVybjsNCisNCisJZHVwbGV4ID0gKChuZWdvdGlh
dGVkICYgMHgwMTAwKSB8fCAobmVnb3RpYXRlZCAmIDB4MDFDMCkgPT0gMHgw
MDQwKT9NRVRIX1BIWV9GRFg6MDsNCisJc3BlZWQgPSAobmVnb3RpYXRlZCAm
IDB4MDM4MCk/TUVUSF8xMDBNQklUOjA7DQorDQorCWlmICgocHJpdi0+bW9k
ZSAmIE1FVEhfUEhZX0ZEWCkgXiBkdXBsZXgpDQorCXsNCisJCURQUklOVEso
IlNldHRpbmcgJXMtZHVwbGV4XG4iLCBkdXBsZXggPyAiZnVsbCIgOiAiaGFs
ZiIpOw0KKwkJaWYgKGR1cGxleCkNCisJCQlwcml2LT5tb2RlIHw9IE1FVEhf
UEhZX0ZEWDsNCisJCWVsc2UNCisJCQlwcml2LT5tb2RlICY9IH5NRVRIX1BI
WV9GRFg7DQorCQlwcml2LT5yZWdzLT5tYWNfY3RybCA9IHByaXYtPm1vZGU7
DQorCX0NCisNCisJaWYgKChwcml2LT5tb2RlICYgTUVUSF8xMDBNQklUKSBe
IHNwZWVkKQ0KKwl7DQorCQlEUFJJTlRLKCJTZXR0aW5nICVkTWJzIG1vZGVc
biIsIHNwZWVkID8gMTAwIDogMTApOw0KKwkJaWYgKGR1cGxleCkNCisJCQlw
cml2LT5tb2RlIHw9IE1FVEhfMTAwTUJJVDsNCisJCWVsc2UNCisJCQlwcml2
LT5tb2RlICY9IH5NRVRIXzEwME1CSVQ7DQorCQlwcml2LT5yZWdzLT5tYWNf
Y3RybCA9IHByaXYtPm1vZGU7DQorCX0NCit9DQorDQorDQogc3RhdGljIGlu
dCBtZXRoX2luaXRfdHhfcmluZyhtZXRoX3ByaXZhdGUgKnByaXYpDQogew0K
IAkvKiBJbml0IFRYIHJpbmcgKi8NCiAJRFBSSU5USygiSW5pdGlhbGl6aW5n
IFRYIHJpbmdcbiIpOw0KLQlwcml2LT50eF9yaW5nPSh0eF9wYWNrZXQqKXBj
aV9hbGxvY19jb25zaXN0ZW50KE5VTEwsVFhfUklOR19CVUZGRVJfU0laRSwm
KHByaXYtPnR4X3JpbmdfZG1hKSk7DQorCXByaXYtPnR4X3JpbmcgPSAodHhf
cGFja2V0ICopIHBjaV9hbGxvY19jb25zaXN0ZW50KE5VTEwsVFhfUklOR19C
VUZGRVJfU0laRSwmKHByaXYtPnR4X3JpbmdfZG1hKSk7DQogCWlmKCFwcml2
LT50eF9yaW5nKQ0KIAkJcmV0dXJuIC1FTk9NRU07DQotCW1lbXNldChwcml2
LT50eF9yaW5nLDAsVFhfUklOR19CVUZGRVJfU0laRSk7DQotCXByaXYtPnJl
Z3MtPnR4X3JpbmdfYmFzZT1wcml2LT50eF9yaW5nX2RtYTsNCi0JcHJpdi0+
ZnJlZV9zcGFjZT1UWF9SSU5HX0VOVFJJRVM7DQotCS8qIE5vdyBpbml0IGtz
YiBzYXZlIGFyZWEgKi8NCisJbWVtc2V0KHByaXYtPnR4X3JpbmcsIDAsIFRY
X1JJTkdfQlVGRkVSX1NJWkUpOw0KKwlwcml2LT50eF9jb3VudCA9IHByaXYt
PnR4X3JlYWQgPSBwcml2LT50eF93cml0ZSA9IDA7DQorCXByaXYtPnJlZ3Mt
PnR4X3JpbmdfYmFzZSA9IHByaXYtPnR4X3JpbmdfZG1hOw0KKwlwcml2LT5m
cmVlX3NwYWNlID0gVFhfUklOR19FTlRSSUVTOw0KKwkvKiBOb3cgaW5pdCBz
a2Igc2F2ZSBhcmVhICovDQogCW1lbXNldChwcml2LT50eF9za2JzLDAsc2l6
ZW9mKHByaXYtPnR4X3NrYnMpKTsNCiAJbWVtc2V0KHByaXYtPnR4X3NrYl9k
bWFzLDAsc2l6ZW9mKHByaXYtPnR4X3NrYl9kbWFzKSk7DQogCURQUklOVEso
IkRvbmUgd2l0aCBUWCByaW5nIGluaXRcbiIpOw0KQEAgLTIzNiwyNyArMjc4
LDc5IEBADQogCWludCBpOw0KIAlEUFJJTlRLKCJJbml0aWFsaXppbmcgUlgg
cmluZ1xuIik7DQogCWZvcihpPTA7aTxSWF9SSU5HX0VOVFJJRVM7aSsrKXsN
Ci0JCURQUklOVEsoIlx0MTpcdCVpXG4iLGkpOw0KKwkJRFBSSU5USygiXHQx
Olx0JWlcdCIsaSk7DQogCQkvKmlmKCEocHJpdi0+cnhfcmluZ1tpXT1nZXRf
ZnJlZV9wYWdlKEdGUF9LRVJORUwpKSkNCiAJCQlyZXR1cm4gLUVOT01FTTsN
CiAJCURQUklOVEsoIlx0MjpcdCVpXG4iLGkpOyovDQogCQlwcml2LT5yeF9y
aW5nW2ldPShyeF9wYWNrZXQqKXBjaV9hbGxvY19jb25zaXN0ZW50KE5VTEws
TUVUSF9SWF9CVUZGX1NJWkUsJihwcml2LT5yeF9yaW5nX2RtYXNbaV0pKTsN
CiAJCS8qIEknbGwgbmVlZCB0byByZS1zeW5jIGl0IGFmdGVyIGVhY2ggUlgg
Ki8NCi0JCURQUklOVEsoIlx0MjpcdCVpXG4iLGkpOw0KKwkJRFBSSU5USygi
XHQlcFxuIixwcml2LT5yeF9yaW5nW2ldKTsNCiAJCXByaXYtPnJlZ3MtPnJ4
X2ZpZm89cHJpdi0+cnhfcmluZ19kbWFzW2ldOw0KIAl9DQorCXByaXYtPnJ4
X3dyaXRlID0gMDsNCiAJRFBSSU5USygiRG9uZSB3aXRoIFJYIHJpbmdcbiIp
Ow0KIAlyZXR1cm4gMDsNCiB9DQogc3RhdGljIHZvaWQgbWV0aF9mcmVlX3R4
X3JpbmcobWV0aF9wcml2YXRlICpwcml2KQ0KIHsNCi0JcGNpX2ZyZWVfY29u
c2lzdGVudChOVUxMLFRYX1JJTkdfQlVGRkVSX1NJWkUscHJpdi0+dHhfcmlu
Zyxwcml2LT50eF9yaW5nX2RtYSk7DQorCWludCBpOw0KKw0KKwkvKiBSZW1v
dmUgYW55IHBlbmRpbmcgc2tiICovDQorCWZvciAoaSA9IDA7IGkgPCBUWF9S
SU5HX0VOVFJJRVM7IGkrKykgew0KKwkgIGlmIChwcml2LT50eF9za2JzW2ld
KQ0KKwkJZGV2X2tmcmVlX3NrYihwcml2LT50eF9za2JzW2ldKTsNCisJCXBy
aXYtPnR4X3NrYnNbaV0gPSBOVUxMOw0KKwl9DQorCXBjaV9mcmVlX2NvbnNp
c3RlbnQoTlVMTCwNCisJCQkgICAgVFhfUklOR19CVUZGRVJfU0laRSwNCisJ
CQkgICAgcHJpdi0+dHhfcmluZywNCisJCQkgICAgcHJpdi0+dHhfcmluZ19k
bWEpOw0KIH0NCiBzdGF0aWMgdm9pZCBtZXRoX2ZyZWVfcnhfcmluZyhtZXRo
X3ByaXZhdGUgKnByaXYpDQogew0KIAlpbnQgaTsNCisNCiAJZm9yKGk9MDtp
PFJYX1JJTkdfRU5UUklFUztpKyspDQotCQlwY2lfZnJlZV9jb25zaXN0ZW50
KE5VTEwsVFhfUklOR19CVUZGRVJfU0laRSxwcml2LT5yeF9yaW5nW2ldLHBy
aXYtPnJ4X3JpbmdfZG1hc1tpXSk7DQorCQlwY2lfZnJlZV9jb25zaXN0ZW50
KE5VTEwsDQorCQkJCSAgICBNRVRIX1JYX0JVRkZfU0laRSwNCisJCQkJICAg
IHByaXYtPnJ4X3JpbmdbaV0sDQorCQkJCSAgICBwcml2LT5yeF9yaW5nX2Rt
YXNbaV0pOw0KK30NCisNCitpbnQgbWV0aF9yZXNldChzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2KQ0KK3sNCisJc3RydWN0IG1ldGhfcHJpdmF0ZSAqcHJpdiA9
IChzdHJ1Y3QgbWV0aF9wcml2YXRlICopIGRldi0+cHJpdjsNCisNCisJLyog
UmVzZXQgY2FyZCAqLw0KKwlwcml2LT5yZWdzLT5tYWNfY3RybCA9IFNHSV9N
QUNfUkVTRVQ7DQorCXByaXYtPnJlZ3MtPm1hY19jdHJsID0gMDsNCisJdWRl
bGF5KDI1KTsNCisJRFBSSU5USygiTUFDIGNvbnRyb2wgYWZ0ZXIgcmVzZXQ6
ICUwMTZseFxuIiwgcHJpdi0+cmVncy0+bWFjX2N0cmwpOw0KKw0KKwkvKiBM
b2FkIGV0aGVybmV0IGFkZHJlc3MgKi8NCisJbG9hZF9lYWRkcihkZXYsIHBy
aXYtPnJlZ3MpOw0KKwkvKiBTaG91bGQgbG9hZCBzb21lICJlcnJhdGEiLCBi
dXQgbGF0ZXIgKi8NCisJDQorCS8qIENoZWNrIGZvciBkZXZpY2UgKi8NCisJ
aWYobWRpb19wcm9iZShwcml2KSA8IDApIHsNCisJCURQUklOVEsoIlVuYWJs
ZSB0byBmaW5kIFBIWVxuIik7DQorCQlyZXR1cm4gLUVOT0RFVjsNCisJfQ0K
Kw0KKwkvKiBJbml0aWFsIG1vZGUgLS0gMTB8SGFsZi1kdXBsZXh8QWNjZXB0
IG5vcm1hbCBwYWNrZXRzICovDQorCXByaXYtPm1vZGU9TUVUSF9BQ0NFUFRf
TUNBU1R8TUVUSF9ERUZBVUxUX0lQRzsNCisJaWYoZGV2LT5mbGFncyB8IElG
Rl9QUk9NSVNDKQ0KKwkJcHJpdi0+bW9kZSB8PSBNRVRIX1BST01JU0M7DQor
CXByaXYtPnJlZ3MtPm1hY19jdHJsID0gcHJpdi0+bW9kZTsNCisNCisJLyog
QXV0b25lZ29jaWF0ZSBzcGVlZCBhbmQgZHVwbGV4IG1vZGUgKi8NCisJbWV0
aF9jaGVja19saW5rKGRldik7DQorDQorCS8qIE5vdyBzZXQgZG1hIGNvbnRy
b2wsIGJ1dCBkb24ndCBlbmFibGUgRE1BLCB5ZXQgKi8NCisJcHJpdi0+cmVn
cy0+ZG1hX2N0cmw9ICg0IDw8IE1FVEhfUlhfT0ZGU0VUX1NISUZUKSB8DQor
CQkgICAgICAgICAgICAgIChSWF9SSU5HX0VOVFJJRVMgPDwgTUVUSF9SWF9E
RVBUSF9TSElGVCk7DQorDQorCXJldHVybigwKTsNCiB9DQogDQogLyo9PT09
PT09PT09PT1FbmQgSGVscGVyIFJvdXRpbmVzPT09PT09PT09PT09PT09PT09
PT09Ki8NCkBAIC0yNjksMTkgKzM2MywyMSBAQA0KIHsNCiAJbWV0aF9wcml2
YXRlICpwcml2PWRldi0+cHJpdjsNCiAJdm9sYXRpbGUgbWV0aF9yZWdzICpy
ZWdzPXByaXYtPnJlZ3M7DQotICAgIE1PRF9JTkNfVVNFX0NPVU5UOw0KKw0K
KwlNT0RfSU5DX1VTRV9DT1VOVDsNCisNCiAJLyogU3RhcnQgRE1BICovDQog
CXJlZ3MtPmRtYV9jdHJsfD0NCi0JCU1FVEhfRE1BX1RYX0VOfC8qTUVUSF9E
TUFfVFhfSU5UX0VOfCovDQorCSAgICAgICAgTUVUSF9ETUFfVFhfRU58LypN
RVRIX0RNQV9UWF9JTlRfRU58Ki8NCiAJCU1FVEhfRE1BX1JYX0VOfE1FVEhf
RE1BX1JYX0lOVF9FTjsNCiANCiAJaWYocmVxdWVzdF9pcnEoZGV2LT5pcnEs
bWV0aF9pbnRlcnJ1cHQsU0FfU0hJUlEsbWV0aF9zdHIsZGV2KSl7DQogCQlw
cmludGsoS0VSTl9FUlIgIiVzOiBDYW4ndCBnZXQgaXJxICVkXG4iLCBkZXYt
Pm5hbWUsIGRldi0+aXJxKTsNCiAJCXJldHVybiAtRUFHQUlOOw0KIAl9DQot
ICAgIG5ldGlmX3N0YXJ0X3F1ZXVlKGRldik7DQorCW5ldGlmX3N0YXJ0X3F1
ZXVlKGRldik7DQogCURQUklOVEsoIk9wZW5lZC4uLiBETUEgY29udHJvbD0w
eCUwOGx4XG4iLCByZWdzLT5kbWFfY3RybCk7DQotICAgIHJldHVybiAwOw0K
KwlyZXR1cm4gMDsNCiB9DQogDQogaW50IG1ldGhfcmVsZWFzZShzdHJ1Y3Qg
bmV0X2RldmljZSAqZGV2KQ0KQEAgLTMzMCw2MCArNDI2LDg3IEBADQogICAg
IHN0cnVjdCBtZXRoX3ByaXZhdGUgKnByaXYgPSAoc3RydWN0IG1ldGhfcHJp
dmF0ZSAqKSBkZXYtPnByaXY7DQogCXJ4X3BhY2tldCAqcnhiOw0KIAlEUFJJ
TlRLKCJSWC4uLlxuIik7DQorCS8vIFRFTVAJd2hpbGUoKHJ4Yj1wcml2LT5y
eF9yaW5nW3ByaXYtPnJ4X3dyaXRlXSktPnN0YXR1cy5yYXcmMHg4MDAwMDAw
MDAwMDAwMDAwKXsNCiAJd2hpbGUoKHJ4Yj1wcml2LT5yeF9yaW5nW3ByaXYt
PnJ4X3dyaXRlXSktPnN0YXR1cy5yYXcmMHg4MDAwMDAwMDAwMDAwMDAwKXsN
Ci0JCWludCBsZW49cnhiLT5zdGF0dXMucGFyc2VkLnJ4X2xlbjsNCi0JCURQ
UklOVEsoIlx0cHJpdi0+dHhfd3JpdGU9JWlcbiIscHJpdi0+cnhfd3JpdGUp
Ow0KKwkgICAgICAgIGludCBsZW49cnhiLT5zdGF0dXMucGFyc2VkLnJ4X2xl
biAtIDQ7IC8qIG9taXQgQ1JDICovDQorCQlEUFJJTlRLKCIoJWkpXG4iLHBy
aXYtPnJ4X3dyaXRlKTsNCisJCS8qIGxlbmd0aCBzYW5pdHkgY2hlY2sgKi8N
CisJCWlmKGxlbiA8IDYwIHx8IGxlbiA+IDE1MTgpIHsNCisJCSAgcHJpbnRr
KEtFUk5fREVCVUcgIiVzOiBib2d1cyBwYWNrZXQgc2l6ZTogJWQsIHN0YXR1
cz0lIzJ4LlxuIiwNCisJCQkgZGV2LT5uYW1lLCBwcml2LT5yeF93cml0ZSwg
cnhiLT5zdGF0dXMucmF3KTsNCisJCSAgcHJpdi0+c3RhdHMucnhfZXJyb3Jz
Kys7DQorCQkgIHByaXYtPnN0YXRzLnJ4X2xlbmd0aF9lcnJvcnMrKzsNCisJ
CX0NCiAJCWlmKCEocnhiLT5zdGF0dXMucmF3Jk1FVEhfUlhfU1RBVFVTX0VS
Uk9SUykpew0KLQkJCURQUklOVEsoIlBhY2tldCBoYWQgbm8gZXJyb3JzLi4u
XG4iKTsNCiAJCQlza2I9YWxsb2Nfc2tiKGxlbisyLEdGUF9BVE9NSUMpOy8q
IFNob3VsZCBiZSBhdG9taWMgLS0gd2UgYXJlIGluIGludGVycnVwdCAqLw0K
IAkJCWlmKCFza2Ipew0KIAkJCQkvKiBPdWNoISBObyBtZW1vcnkhIERyb3Ag
cGFja2V0IG9uIHRoZSBmbG9vciAqLw0KIAkJCQlEUFJJTlRLKCIhISE+Pj5P
dWNoISBOb3QgZW5vdWdoIE1lbW9yeSBmb3IgUlggYnVmZmVyIVxuIik7DQot
CQkJCXByaXYtPnN0YXRzLnR4X2Ryb3BwZWQrKzsNCisJCQkJcHJpdi0+c3Rh
dHMucnhfZHJvcHBlZCsrOw0KIAkJCX0gZWxzZSB7DQotCQkJCURQUklOVEso
IkFuZCB0aGVyZSB3YXMgbm8gcHJvYmxlbSBnZXR0aW5nIG5ldyBza2IuLi5c
biIpOw0KIAkJCQlza2JfcmVzZXJ2ZShza2IsIDIpOyAvKiBhbGlnbiBJUCBv
biAxNkIgYm91bmRhcnkgKi8gIA0KICAgICAJCQltZW1jcHkoc2tiX3B1dChz
a2IsIGxlbiksIHJ4Yi0+YnVmLCBsZW4pOw0KIAkJCSAgICAvKiBXcml0ZSBt
ZXRhZGF0YSwgYW5kIHRoZW4gcGFzcyB0byB0aGUgcmVjZWl2ZSBsZXZlbCAq
Lw0KIAkJCSAgICBza2ItPmRldiA9IGRldjsNCiAJCQkgICAgc2tiLT5wcm90
b2NvbCA9IGV0aF90eXBlX3RyYW5zKHNrYiwgZGV2KTsNCiAJCQkJLy9za2It
PmlwX3N1bW1lZCA9IENIRUNLU1VNX1VOTkVDRVNTQVJZOyAvKiBkb24ndCBj
aGVjayBpdCAqLw0KLQkJCSAgICBwcml2LT5zdGF0cy5yeF9wYWNrZXRzKys7
DQotCQkJCURQUklOVEsoIldlIGFyZSBhYm91dCB0byBwYXNzIHBhY2tldCB1
cFxuIik7DQotICAgIAkJCW5ldGlmX3J4KHNrYik7DQorCQkJICAgDQorCQkJ
CURQUklOVEsoInBhc3NpbmcgcGFja2V0XG4iKTsNCisJCQkJRFBSSU5USygi
bGVuID0gJWQgcnhiLT5zdGF0dXMgPSAleFxuIiwNCisJCQkJCWxlbiwgcnhi
LT5zdGF0dXMucmF3KTsNCisJCQkJbmV0aWZfcngoc2tiKTsNCisJCQkJZGV2
LT5sYXN0X3J4ID0gamlmZmllczsNCisJCQkJcHJpdi0+c3RhdHMucnhfcGFj
a2V0cysrOw0KKwkJCQlwcml2LT5zdGF0cy5yeF9ieXRlcys9bGVuOw0KIAkJ
CQlEUFJJTlRLKCJUaGVyZSB3ZSBnby4uLiBXaGV3Li4uXG4iKTsNCiAJCQl9
DQogCQl9DQotCQlyeGItPnN0YXR1cy5yYXc9MDsNCiAJCXByaXYtPnJlZ3Mt
PnJ4X2ZpZm89cHJpdi0+cnhfcmluZ19kbWFzW3ByaXYtPnJ4X3dyaXRlXTsN
CisJCXJ4Yi0+c3RhdHVzLnJhdz0wOwkJDQogCQlwcml2LT5yeF93cml0ZT0o
cHJpdi0+cnhfd3JpdGUrMSkmKFJYX1JJTkdfRU5UUklFUy0xKTsNCiAJfQ0K
IH0NCiANCitzdGF0aWMgaW50IG1ldGhfdHhfZnVsbChzdHJ1Y3QgbmV0X2Rl
dmljZSAqZGV2KQ0KK3sNCisJc3RydWN0IG1ldGhfcHJpdmF0ZSAqcHJpdiA9
IChzdHJ1Y3QgbWV0aF9wcml2YXRlICopIGRldi0+cHJpdjsNCisNCisJcmV0
dXJuKHByaXYtPnR4X2NvdW50ID49IFRYX1JJTkdfRU5UUklFUy0xKTsNCit9
DQorDQogdm9pZCBtZXRoX3R4X2NsZWFudXAoc3RydWN0IG5ldF9kZXZpY2Uq
IGRldiwgaW50IHJwdHIpDQogew0KIAltZXRoX3ByaXZhdGUgKnByaXY9ZGV2
LT5wcml2Ow0KLQkvL3ZvbGF0aWxlIG1ldGhfcmVncyogcmVncz1wcml2LT5y
ZWdzOw0KIAl0eF9wYWNrZXQqIHN0YXR1czsNCi0Jc3RydWN0IHNrX2J1ZmYq
IHNrYjsNCi0JRFBSSU5USygiVFguLi5cbiIpOw0KKwlzdHJ1Y3Qgc2tfYnVm
ZiAqc2tiOw0KKw0KIAlzcGluX2xvY2soJnByaXYtPm1ldGhfbG9jayk7DQot
CXByaXYtPnJlZ3MtPmRtYV9jdHJsJj1+KE1FVEhfRE1BX1RYX0lOVF9FTik7
DQotCXdoaWxlKHByaXYtPnR4X3JlYWQhPXJwdHIpew0KLQkJc2tiPXByaXYt
PnR4X3NrYnNbcHJpdi0+dHhfcmVhZF07DQotCQlzdGF0dXM9JnByaXYtPnR4
X3JpbmdbcHJpdi0+dHhfcmVhZF07DQorDQorCS8qIFN0b3AgRE1BICovDQor
CXByaXYtPnJlZ3MtPmRtYV9jdHJsICY9IH4oTUVUSF9ETUFfVFhfSU5UX0VO
KTsNCisNCisJd2hpbGUocHJpdi0+dHhfcmVhZCAhPSBycHRyKXsNCisJCXNr
YiA9IHByaXYtPnR4X3NrYnNbcHJpdi0+dHhfcmVhZF07DQorCQlzdGF0dXMg
PSAmcHJpdi0+dHhfcmluZ1twcml2LT50eF9yZWFkXTsNCiAJCWlmKCFzdGF0
dXMtPmhlYWRlci5yZXMuc2VudCkNCiAJCQlicmVhazsNCi0JCWlmKHN0YXR1
cy0+aGVhZGVyLnJhdyZNRVRIX1RYX1NUQVRVU19ET05FKXsNCisJCWlmKHN0
YXR1cy0+aGVhZGVyLnJhdyAmIE1FVEhfVFhfU1RBVFVTX0RPTkUpIHsNCiAJ
CQlwcml2LT5zdGF0cy50eF9wYWNrZXRzKys7DQotCQkJcHJpdi0+c3RhdHMu
dHhfYnl0ZXMrPXNrYi0+bGVuOw0KKwkJCXByaXYtPnN0YXRzLnR4X2J5dGVz
ICs9IHNrYi0+bGVuOw0KIAkJfQ0KLSAgICAgICAgZGV2X2tmcmVlX3NrYihz
a2IpOw0KLQkJc3RhdHVzLT5oZWFkZXIucmF3PTA7DQotCQlwcml2LT50eF9y
ZWFkPShwcml2LT50eF9yZWFkKzEpJihUWF9SSU5HX0VOVFJJRVMtMSk7DQor
CQlkZXZfa2ZyZWVfc2tiX2lycShza2IpOw0KKwkJcHJpdi0+dHhfc2tic1tw
cml2LT50eF9yZWFkXSA9IE5VTEw7DQorCQlzdGF0dXMtPmhlYWRlci5yYXcg
PSAwOw0KKwkJcHJpdi0+dHhfcmVhZCA9IChwcml2LT50eF9yZWFkKzEpJihU
WF9SSU5HX0VOVFJJRVMtMSk7DQorCQlwcml2LT50eF9jb3VudCAtLTsNCiAJ
fQ0KKw0KKwkvKiB3YWtlIHVwIHF1ZXVlIGlmIGl0IHdhcyBzdG9wcGVkICov
DQorCWlmIChuZXRpZl9xdWV1ZV9zdG9wcGVkKGRldikgJiYgISBtZXRoX3R4
X2Z1bGwoZGV2KSkgew0KKwkJbmV0aWZfd2FrZV9xdWV1ZShkZXYpOw0KKwl9
DQorDQogCXNwaW5fdW5sb2NrKHByaXYtPm1ldGhfbG9jayk7DQotCW5ldGlm
X3dha2VfcXVldWUoZGV2KTsNCiB9DQogDQogLyoNCkBAIC0zOTEsOCArNTE0
LDcgQEANCiAgKi8NCiB2b2lkIG1ldGhfaW50ZXJydXB0KGludCBpcnEsIHZv
aWQgKmRldl9pZCwgc3RydWN0IHB0X3JlZ3MgKnByZWdzKQ0KIHsNCi0gICAg
c3RydWN0IG1ldGhfcHJpdmF0ZSAqcHJpdjsNCi0JLy92b2xhdGlsZSBtZXRo
X3JlZ3MqIHJlZ3M7DQorCXN0cnVjdCBtZXRoX3ByaXZhdGUgKnByaXY7DQog
CXVuaW9uIHsNCiAJCXUzMglyZWc7IC8qV2hvbGUgc3RhdHVzIHJlZ2lzdGVy
ICovDQogCQlzdHJ1Y3Qgew0KQEAgLTQwNCw0OCArNTI2LDU0IEBADQogCQkJ
CWludF9tYXNrOgk4Ow0KIAkJfSBwYXJzZWQ7DQogCX0gc3RhdHVzOw0KLSAg
ICAvKg0KLSAgICAgKiBBcyB1c3VhbCwgY2hlY2sgdGhlICJkZXZpY2UiIHBv
aW50ZXIgZm9yIHNoYXJlZCBoYW5kbGVycy4NCi0gICAgICogVGhlbiBhc3Np
Z24gInN0cnVjdCBkZXZpY2UgKmRldiINCi0gICAgICovDQotICAgIHN0cnVj
dCBuZXRfZGV2aWNlICpkZXYgPSAoc3RydWN0IG5ldF9kZXZpY2UgKilkZXZf
aWQ7DQotICAgIC8qIC4uLiBhbmQgY2hlY2sgd2l0aCBodyBpZiBpdCdzIHJl
YWxseSBvdXJzICovDQotDQotICAgIGlmICghZGV2IC8qcGFyYW5vaWQqLyAp
IHJldHVybjsNCi0NCi0gICAgLyogTG9jayB0aGUgZGV2aWNlICovDQotICAg
IHByaXYgPSAoc3RydWN0IG1ldGhfcHJpdmF0ZSAqKSBkZXYtPnByaXY7DQot
ICAgIHNwaW5fbG9jaygmcHJpdi0+bWV0aF9sb2NrKTsNCisJLyoNCisJICog
QXMgdXN1YWwsIGNoZWNrIHRoZSAiZGV2aWNlIiBwb2ludGVyIGZvciBzaGFy
ZWQgaGFuZGxlcnMuDQorCSAqIFRoZW4gYXNzaWduICJzdHJ1Y3QgZGV2aWNl
ICpkZXYiDQorCSAqLw0KKwlzdHJ1Y3QgbmV0X2RldmljZSAqZGV2ID0gKHN0
cnVjdCBuZXRfZGV2aWNlICopZGV2X2lkOw0KKwkvKiAuLi4gYW5kIGNoZWNr
IHdpdGggaHcgaWYgaXQncyByZWFsbHkgb3VycyAqLw0KIA0KLSAgICBzdGF0
dXMucmVnID0gcHJpdi0+cmVncy0+aW50X2ZsYWdzOw0KLQlwcml2LT5yZWdz
LT5pbnRfZmxhZ3M9c3RhdHVzLnJlZyYweGZmOyAvKiBjbGVhciBpbnRlcnJ1
cHRzICovDQorCWlmICghZGV2IC8qcGFyYW5vaWQqLyApIHJldHVybjsNCisN
CisJLyogTG9jayB0aGUgZGV2aWNlICovDQorCXByaXYgPSAoc3RydWN0IG1l
dGhfcHJpdmF0ZSAqKSBkZXYtPnByaXY7DQorDQorCXN0YXR1cy5yZWcgPSBw
cml2LT5yZWdzLT5pbnRfZmxhZ3M7DQorICAgIA0KIAlEUFJJTlRLKCJJbnRl
cnJ1cHQsIHN0YXR1cyAlMDh4Li4uXG4iLHN0YXR1cy5yZWcpOw0KLSAgICBp
ZiAoc3RhdHVzLnBhcnNlZC5pbnRfbWFzayAmIE1FVEhfSU5UX1JYX1RIUkVT
SE9MRCkgew0KLSAgICAgICAgLyogc2VuZCBpdCB0byBtZXRoX3J4IGZvciBo
YW5kbGluZyAqLw0KLSAgICAgICAgbWV0aF9yeChkZXYpOw0KLSAgICB9DQot
ICAgIGlmIChzdGF0dXMucGFyc2VkLmludF9tYXNrICYgKE1FVEhfSU5UX1RY
X0VNUFRZfE1FVEhfSU5UX1RYX1BLVCkpIHsNCi0gICAgICAgIC8qIGEgdHJh
bnNtaXNzaW9uIGlzIG92ZXI6IGZyZWUgdGhlIHNrYiAqLw0KLQkJbWV0aF90
eF9jbGVhbnVwKGRldixzdGF0dXMucGFyc2VkLnR4X3JlYWQpOw0KLSAgICB9
DQotCS8qIGNoZWNrIGZvciBlcnJvcnMgdG9vLi4uICovDQorCWlmIChzdGF0
dXMucGFyc2VkLmludF9tYXNrICYgTUVUSF9JTlRfUlhfVEhSRVNIT0xEKSB7
DQorCQkvKiBzZW5kIGl0IHRvIG1ldGhfcnggZm9yIGhhbmRsaW5nICovDQor
CQltZXRoX3J4KGRldik7DQorCX0NCiANCisJaWYgKHN0YXR1cy5wYXJzZWQu
aW50X21hc2sgJiAoTUVUSF9JTlRfVFhfRU1QVFl8TUVUSF9JTlRfVFhfUEtU
KSkgew0KKwkJLyogYSB0cmFuc21pc3Npb24gaXMgb3ZlcjogZnJlZSB0aGUg
c2tiICovDQorCQltZXRoX3R4X2NsZWFudXAoZGV2LCBzdGF0dXMucGFyc2Vk
LnR4X3JlYWQpOw0KKwl9DQorCS8qIGNoZWNrIGZvciBlcnJvcnMgdG9vLi4u
ICovDQorCWlmIChzdGF0dXMucGFyc2VkLmludF9tYXNrICYgKE1FVEhfSU5U
X1RYX0xJTktfRkFJTCkpDQorCQlwcmludGsoS0VSTl9XQVJOSU5HICJtZXRo
OiBsaW5rIGZhaWx1cmVcbiIpOw0KKwlpZiAoc3RhdHVzLnBhcnNlZC5pbnRf
bWFzayAmIChNRVRIX0lOVF9NRU1fRVJST1IpKQ0KKwkJcHJpbnRrKEtFUk5f
V0FSTklORyAibWV0aDogbWVtb3J5IGVycm9yXG4iKTsNCisJaWYgKHN0YXR1
cy5wYXJzZWQuaW50X21hc2sgJiAoTUVUSF9JTlRfVFhfQUJPUlQpKQ0KKwkJ
cHJpbnRrKEtFUk5fV0FSTklORyAibWV0aDogYWJvcnRlZFxuIik7DQogCURQ
UklOVEsoIkludGVycnVwdCBoYW5kbGluZyBkb25lLi4uXG4iKTsNCi0gICAg
LyogVW5sb2NrIHRoZSBkZXZpY2UgYW5kIHdlIGFyZSBkb25lICovDQotICAg
IHNwaW5fdW5sb2NrKCZwcml2LT5tZXRoX2xvY2spOw0KKwkNCisJcHJpdi0+
cmVncy0+aW50X2ZsYWdzPXN0YXR1cy5yZWcmMHhmZjsgLyogY2xlYXIgaW50
ZXJydXB0cyAqLw0KIH0NCiANCiAvKg0KLSAqIFRyYW5zbWl0cyBwYWNrZXRz
IHRoYXQgZml0IGludG8gVFggZGVzY3JpYnRvciAoYXJlIDw9MTIwQikNCisg
KiBUcmFuc21pdHMgcGFja2V0cyB0aGF0IGZpdCBpbnRvIFRYIGRlc2NyaXB0
b3IgKGFyZSA8PTEyMEIpDQogICovDQogc3RhdGljIHZvaWQgbWV0aF90eF9z
aG9ydF9wcmVwYXJlKG1ldGhfcHJpdmF0ZSogcHJpdiwgc3RydWN0IHNrX2J1
ZmYqIHNrYikNCiB7DQogCXR4X3BhY2tldCAqZGVzYz0mcHJpdi0+dHhfcmlu
Z1twcml2LT50eF93cml0ZV07DQotCWludCBsZW49KHNrYi0+bGVuPEVUSF9a
TEVOKT9FVEhfWkxFTjpza2ItPmxlbjsNCi0JRFBSSU5USygiU2hvcnQgcGFj
a2V0Li4uIFxuIik7DQotCS8qIGFteWJlIEkgc2hvdWxkIHNldCB3aG9sZSB0
aGluZyB0byAwIGZpcnN0Li4uICovDQorCWludCBsZW4gPSAoc2tiLT5sZW48
RVRIX1pMRU4pP0VUSF9aTEVOOnNrYi0+bGVuOw0KKw0KKwlEUFJJTlRLKCJw
cmVwYXJpbmcgc2hvcnQgcGFja2V0XG4iKTsNCisJLyogbWF5YmUgSSBzaG91
bGQgc2V0IHdob2xlIHRoaW5nIHRvIDAgZmlyc3QuLi4gKi8NCiAJbWVtY3B5
KGRlc2MtPmRhdGEuZHQrKDEyMC1sZW4pLHNrYi0+ZGF0YSxza2ItPmxlbik7
DQotCWlmKHNrYi0+bGVuPGxlbikNCisJaWYoc2tiLT5sZW4gPCBsZW4pDQog
CQltZW1zZXQoZGVzYy0+ZGF0YS5kdCsxMjAtbGVuK3NrYi0+bGVuLDAsbGVu
LXNrYi0+bGVuKTsNCiAJZGVzYy0+aGVhZGVyLnJhdz1NRVRIX1RYX0NNRF9J
TlRfRU58KGxlbi0xKXwoKDEyOC1sZW4pPDwxNik7DQogCURQUklOVEsoImRl
c2M9JTAxNmx4XG4iLGRlc2MtPmhlYWRlci5yYXcpOw0KQEAgLTQ1NCw4NiAr
NTgyLDE3MiBAQA0KIHN0YXRpYyB2b2lkIG1ldGhfdHhfMXBhZ2VfcHJlcGFy
ZShtZXRoX3ByaXZhdGUqIHByaXYsIHN0cnVjdCBza19idWZmKiBza2IpDQog
ew0KIAl0eF9wYWNrZXQgKmRlc2M9JnByaXYtPnR4X3JpbmdbcHJpdi0+dHhf
d3JpdGVdOw0KLQl2b2lkICpkYXRhPXNrYi0+ZGF0YTsNCi0JaW50IGxlbj0o
dTY0KWRhdGEmMHg3Ow0KKwl2b2lkICpidWZmZXJfZGF0YSA9ICh2b2lkICop
KCgodTY0KXNrYi0+ZGF0YSArIDdVTEwpICYgKH43VUxMKSk7DQorCWludCB1
bmFsaWduZWRfbGVuID0gKGludCkoKHU2NClidWZmZXJfZGF0YSAtICh1NjQp
c2tiLT5kYXRhKTsNCisJaW50IGJ1ZmZlcl9sZW4gPSBza2ItPmxlbiAtIHVu
YWxpZ25lZF9sZW47DQogCWRtYV9hZGRyX3QgY2F0YnVmOw0KKw0KKwlEUFJJ
TlRLKCJwcmVwYXJpbmcgMSBwYWdlLi4uXG4iKTsNCisJRFBSSU5USygibGVu
Z3RoPSVkIGRhdGE9JXBcbiIsIHNrYi0+bGVuLCBza2ItPmRhdGEpOw0KKwlE
UFJJTlRLKCJ1bmFsaWduZWRfbGVuPSVkXG4iLCB1bmFsaWduZWRfbGVuKTsN
CisJRFBSSU5USygiYnVmZmVyX2RhdGE9JXAgYnVmZmVyX2xlbj0lZFxuIiwN
CisJICAgICAgIGJ1ZmZlcl9kYXRhLA0KKwkgICAgICAgYnVmZmVyX2xlbik7
DQorDQogCWRlc2MtPmhlYWRlci5yYXc9TUVUSF9UWF9DTURfSU5UX0VOfFRY
X0NBVEJVRjF8KHNrYi0+bGVuLTEpOw0KLQlpZihsZW4pew0KLQkJbWVtY3B5
KGRlc2MtPmRhdGEuZHQrKDEyMC1sZW4pLGRhdGEsbGVuKTsNCi0JCWRlc2Mt
PmhlYWRlci5yYXd8PSgxMjgtbGVuKTw8MTY7DQotCX0NCi0JZGF0YSs9bGVu
Ow0KLQkvKiBJJ2xsIGp1c3QgcHJldGVuZCBJIGtub3cgZm9yIHN1cmUgdGhh
dCBwY2lfdW5tYXBfc2luZ2xlIGlzIE5PUCAqLw0KLQljYXRidWY9cGNpX21h
cF9zaW5nbGUoTlVMTCxkYXRhLHNrYi0+bGVuLWxlbixQQ0lfRE1BX1RPREVW
SUNFKTsNCi0JZGVzYy0+ZGF0YS5jYXRfYnVmWzBdLnJhdz1jYXRidWZ8KChz
a2ItPmxlbi1sZW4tMSk8PDMxKTsNCisNCisJLyogdW5hbGlnbmVkIHBhcnQg
Ki8NCisJaWYodW5hbGlnbmVkX2xlbil7DQorCQltZW1jcHkoZGVzYy0+ZGF0
YS5kdCsoMTIwLXVuYWxpZ25lZF9sZW4pLA0KKwkJICAgICAgIHNrYi0+ZGF0
YSwgdW5hbGlnbmVkX2xlbik7DQorCQlkZXNjLT5oZWFkZXIucmF3IHw9ICgx
MjgtdW5hbGlnbmVkX2xlbikgPDwgMTY7DQorCX0NCisNCisJLyogZmlyc3Qg
cGFnZSAqLw0KKwljYXRidWYgPSBwY2lfbWFwX3NpbmdsZShOVUxMLA0KKwkJ
CQlidWZmZXJfZGF0YSwNCisJCQkJYnVmZmVyX2xlbiwNCisJCQkJUENJX0RN
QV9UT0RFVklDRSk7DQorCURQUklOVEsoImNhdGJ1Zj0leFxuIiwgY2F0YnVm
KTsNCisJZGVzYy0+ZGF0YS5jYXRfYnVmWzBdLmZvcm0uc3RhcnRfYWRkciA9
IGNhdGJ1ZiA+PiAzOw0KKwlkZXNjLT5kYXRhLmNhdF9idWZbMF0uZm9ybS5s
ZW4gPSBidWZmZXJfbGVuLTE7DQorCURQUklOVEsoImRlc2M9JTAxNmx4XG4i
LGRlc2MtPmhlYWRlci5yYXcpOw0KKwlEUFJJTlRLKCJjYXRfYnVmWzBdLnJh
dz0lMDE2bHhcbiIsZGVzYy0+ZGF0YS5jYXRfYnVmWzBdLnJhdyk7DQogfQ0K
ICNkZWZpbmUgVFhfQ0FUQlVGMiBCSVQoMjYpDQogc3RhdGljIHZvaWQgbWV0
aF90eF8ycGFnZV9wcmVwYXJlKG1ldGhfcHJpdmF0ZSogcHJpdiwgc3RydWN0
IHNrX2J1ZmYqIHNrYikNCiB7DQogCXR4X3BhY2tldCAqZGVzYz0mcHJpdi0+
dHhfcmluZ1twcml2LT50eF93cml0ZV07DQotCXZvaWQgKmRhdGE9c2tiLT5k
YXRhOw0KLQlpbnQgbGVuPSh1NjQpZGF0YSYweDc7DQotCWRtYV9hZGRyX3Qg
Y2F0YnVmMSxjYXRidWYyOw0KKwl2b2lkICpidWZmZXIxX2RhdGEgPSAodm9p
ZCAqKSgoKHU2NClza2ItPmRhdGEgKyA3VUxMKSAmICh+N1VMTCkpOw0KKwl2
b2lkICpidWZmZXIyX2RhdGEgPSAodm9pZCAqKVBBR0VfQUxJR04oKHU2NClz
a2ItPmRhdGEpOw0KKwlpbnQgdW5hbGlnbmVkX2xlbiA9IChpbnQpKCh1NjQp
YnVmZmVyMV9kYXRhIC0gKHU2NClza2ItPmRhdGEpOw0KKwlpbnQgYnVmZmVy
MV9sZW4gPSAoaW50KSgodTY0KWJ1ZmZlcjJfZGF0YSAtICh1NjQpYnVmZmVy
MV9kYXRhKTsNCisJaW50IGJ1ZmZlcjJfbGVuID0gc2tiLT5sZW4gLSBidWZm
ZXIxX2xlbiAtIHVuYWxpZ25lZF9sZW47DQorCWRtYV9hZGRyX3QgY2F0YnVm
MSwgY2F0YnVmMjsNCisNCisJRFBSSU5USygicHJlcGFyaW5nIDIgcGFnZXMu
Li4gXG4iKTsNCisJRFBSSU5USygibGVuZ3RoPSVkIGRhdGE9JXBcbiIsIHNr
Yi0+bGVuLCBza2ItPmRhdGEpOw0KKwlEUFJJTlRLKCJ1bmFsaWduZWRfbGVu
PSVkXG4iLCB1bmFsaWduZWRfbGVuKTsNCisJRFBSSU5USygiYnVmZmVyMV9k
YXRhPSVwIGJ1ZmZlcjFfbGVuPSVkXG4iLA0KKwkgICAgICAgYnVmZmVyMV9k
YXRhLA0KKwkgICAgICAgYnVmZmVyMV9sZW4pOw0KKwlEUFJJTlRLKCJidWZm
ZXIyX2RhdGE9JXAgYnVmZmVyMl9sZW49JWRcbiIsDQorCSAgICAgICBidWZm
ZXIyX2RhdGEsDQorCSAgICAgICBidWZmZXIyX2xlbik7DQorDQogCWRlc2Mt
PmhlYWRlci5yYXc9TUVUSF9UWF9DTURfSU5UX0VOfFRYX0NBVEJVRjF8VFhf
Q0FUQlVGMnwoc2tiLT5sZW4tMSk7DQotCWlmKGxlbil7DQotCQltZW1jcHko
ZGVzYy0+ZGF0YS5kdCsoMTIwLWxlbiksZGF0YSxsZW4pOw0KLQkJZGVzYy0+
aGVhZGVyLnJhd3w9KDEyOC1sZW4pPDwxNjsNCi0JfQ0KLQlkYXRhKz1sZW47
DQotCS8qIEknbGwganVzdCBwcmV0ZW5kIEkga25vdyBmb3Igc3VyZSB0aGF0
IHBjaV91bm1hcF9zaW5nbGUgaXMgTk9QICovDQotCWNhdGJ1ZjE9cGNpX21h
cF9zaW5nbGUoTlVMTCxkYXRhLHNrYi0+bGVuLWxlbixQQ0lfRE1BX1RPREVW
SUNFKTsNCi0JZGVzYy0+ZGF0YS5jYXRfYnVmWzBdLnJhdz1jYXRidWYxfCgo
c2tiLT5sZW4tbGVuLTEpPDwzMSk7DQotCWxlbj0odTY0KWRhdGEmMHhGRkY7
DQotCWRhdGErPWxlbjsNCi0JY2F0YnVmMj1wY2lfbWFwX3NpbmdsZShOVUxM
LGRhdGEsc2tiLT5sZW4tKCh1NjQpZGF0YS0odTY0KXNrYi0+ZGF0YSksUENJ
X0RNQV9UT0RFVklDRSk7DQotCWRlc2MtPmRhdGEuY2F0X2J1ZlsxXS5yYXc9
Y2F0YnVmMnwoKHNrYi0+bGVuLSgodTY0KWRhdGEtKHU2NClza2ItPmRhdGEp
KTw8MzEpOw0KKwkvKiB1bmFsaWduZWQgcGFydCAqLw0KKwlpZih1bmFsaWdu
ZWRfbGVuKXsNCisJCW1lbWNweShkZXNjLT5kYXRhLmR0KygxMjAtdW5hbGln
bmVkX2xlbiksDQorCQkgICAgICAgc2tiLT5kYXRhLCB1bmFsaWduZWRfbGVu
KTsNCisJCWRlc2MtPmhlYWRlci5yYXcgfD0gKDEyOC11bmFsaWduZWRfbGVu
KSA8PCAxNjsNCisJfQ0KKw0KKwkvKiBmaXJzdCBwYWdlICovDQorCWNhdGJ1
ZjEgPSBwY2lfbWFwX3NpbmdsZShOVUxMLA0KKwkJCQkgYnVmZmVyMV9kYXRh
LA0KKwkJCQkgYnVmZmVyMV9sZW4sDQorCQkJCSBQQ0lfRE1BX1RPREVWSUNF
KTsNCisJRFBSSU5USygiY2F0YnVmMT0leFxuIiwgY2F0YnVmMSk7DQorCWRl
c2MtPmRhdGEuY2F0X2J1ZlswXS5mb3JtLnN0YXJ0X2FkZHIgPSBjYXRidWYx
ID4+IDM7DQorCWRlc2MtPmRhdGEuY2F0X2J1ZlswXS5mb3JtLmxlbiA9IGJ1
ZmZlcjFfbGVuLTE7DQorCS8qIHNlY29uZCBwYWdlICovDQorCWNhdGJ1ZjIg
PSBwY2lfbWFwX3NpbmdsZShOVUxMLA0KKwkJCQkgYnVmZmVyMl9kYXRhLA0K
KwkJCQkgYnVmZmVyMl9sZW4sDQorCQkJCSBQQ0lfRE1BX1RPREVWSUNFKTsN
CisJRFBSSU5USygiY2F0YnVmMj0leFxuIiwgY2F0YnVmMik7DQorCWRlc2Mt
PmRhdGEuY2F0X2J1ZlsxXS5mb3JtLnN0YXJ0X2FkZHIgPSBjYXRidWYyID4+
IDM7DQorCWRlc2MtPmRhdGEuY2F0X2J1ZlsxXS5mb3JtLmxlbiA9IGJ1ZmZl
cjJfbGVuLTE7DQorCURQUklOVEsoImRlc2M9JTAxNmx4XG4iLGRlc2MtPmhl
YWRlci5yYXcpOw0KKwlEUFJJTlRLKCJjYXRfYnVmWzBdLnJhdz0lMDE2bHhc
biIsZGVzYy0+ZGF0YS5jYXRfYnVmWzBdLnJhdyk7DQorCURQUklOVEsoImNh
dF9idWZbMV0ucmF3PSUwMTZseFxuIixkZXNjLT5kYXRhLmNhdF9idWZbMV0u
cmF3KTsNCiB9DQorDQorDQordm9pZCBtZXRoX2FkZF90b190eF9yaW5nKG1l
dGhfcHJpdmF0ZSAqcHJpdiwgc3RydWN0IHNrX2J1ZmYqIHNrYikNCit7DQor
CURQUklOVEsoIlRyYW5zbWl0dGluZyBkYXRhLi4uXG4iKTsNCisJaWYoc2ti
LT5sZW4gPD0gMTIwKSB7DQorCQkvKiBXaG9sZSBwYWNrZXQgZml0cyBpbnRv
IGRlc2NyaXB0b3IgKi8NCisJCW1ldGhfdHhfc2hvcnRfcHJlcGFyZShwcml2
LHNrYik7DQorCX0gZWxzZSBpZihQQUdFX0FMSUdOKCh1NjQpc2tiLT5kYXRh
KSAhPQ0KKwkJICBQQUdFX0FMSUdOKCh1NjQpc2tiLT5kYXRhK3NrYi0+bGVu
LTEpKSB7DQorCQkvKiBQYWNrZXQgY3Jvc3NlcyBwYWdlIGJvdW5kYXJ5ICov
DQorCQltZXRoX3R4XzJwYWdlX3ByZXBhcmUocHJpdixza2IpOw0KKwl9IGVs
c2Ugew0KKwkJLyogUGFja2V0IGlzIGluIG9uZSBwYWdlICovDQorCQltZXRo
X3R4XzFwYWdlX3ByZXBhcmUocHJpdixza2IpOw0KKwl9DQorDQorCS8qIFJl
bWVtYmVyIHRoZSBza2IsIHNvIHdlIGNhbiBmcmVlIGl0IGF0IGludGVycnVw
dCB0aW1lICovDQorCXByaXYtPnR4X3NrYnNbcHJpdi0+dHhfd3JpdGVdID0g
c2tiOw0KKwlwcml2LT50eF93cml0ZSA9IChwcml2LT50eF93cml0ZSsxKSAm
IChUWF9SSU5HX0VOVFJJRVMtMSk7DQorCXByaXYtPnJlZ3MtPnR4X2luZm8u
d3B0ciA9IHByaXYtPnR4X3dyaXRlOw0KKwlwcml2LT50eF9jb3VudCArKzsN
CisJLyogRW5hYmxlIERNQSB0cmFuc2ZlciAqLw0KKwlwcml2LT5yZWdzLT5k
bWFfY3RybCB8PSBNRVRIX0RNQV9UWF9JTlRfRU47DQorfQ0KKw0KIC8qDQog
ICogVHJhbnNtaXQgYSBwYWNrZXQgKGNhbGxlZCBieSB0aGUga2VybmVsKQ0K
ICAqLw0KIGludCBtZXRoX3R4KHN0cnVjdCBza19idWZmICpza2IsIHN0cnVj
dCBuZXRfZGV2aWNlICpkZXYpDQogew0KLSAgICBzdHJ1Y3QgbWV0aF9wcml2
YXRlICpwcml2ID0gKHN0cnVjdCBtZXRoX3ByaXZhdGUgKikgZGV2LT5wcml2
Ow0KKwlzdHJ1Y3QgbWV0aF9wcml2YXRlICpwcml2ID0gKHN0cnVjdCBtZXRo
X3ByaXZhdGUgKikgZGV2LT5wcml2Ow0KIA0KLSAgICBzcGluX2xvY2soJnBy
aXYtPm1ldGhfbG9jayk7DQotCURQUklOVEsoIlRyYW5zbWl0dGluZyBkYXRh
Li4uXG4iKTsNCi0JaWYoc2tiLT5sZW48PTEyMCkgLyogV2hvbGUgdGhpbmcg
Zml0cyBpbnRvIGRlc2NyaXB0b3IgKi8NCi0JCW1ldGhfdHhfc2hvcnRfcHJl
cGFyZShwcml2LHNrYik7DQotCWVsc2UgaWYoKCh1NjQpKHNrYi0+ZGF0YSkm
MHhGRkYpPHNrYi0+bGVuKSAvKiBQYWNrZXQgY3Jvc3NlcyBwYWdlIGJvdW5k
YXJ5ICovDQotCQltZXRoX3R4XzJwYWdlX3ByZXBhcmUocHJpdixza2IpOw0K
LQllbHNlIC8qIFBhY2tldCBpcyBpbiBvbmUgcGFnZSAqLw0KLQkJbWV0aF90
eF8xcGFnZV9wcmVwYXJlKHByaXYsc2tiKTsNCi0gICAgZGV2LT50cmFuc19z
dGFydCA9IGppZmZpZXM7IC8qIHNhdmUgdGhlIHRpbWVzdGFtcCAqLw0KKwlz
cGluX2xvY2tfaXJxKCZwcml2LT5tZXRoX2xvY2spOw0KIA0KLSAgICAvKiBS
ZW1lbWJlciB0aGUgc2tiLCBzbyB3ZSBjYW4gZnJlZSBpdCBhdCBpbnRlcnJ1
cHQgdGltZSAqLw0KLSAgICBwcml2LT50eF9za2JzW3ByaXYtPnR4X3dyaXRl
XSA9IHNrYjsNCi0JcHJpdi0+cmVncy0+dHhfaW5mby53cHRyPXByaXYtPnR4
X3dyaXRlOw0KLQlwcml2LT50eF93cml0ZT0ocHJpdi0+dHhfd3JpdGUrMSkm
KFRYX1JJTkdfRU5UUklFUy0xKTsNCisJbWV0aF9hZGRfdG9fdHhfcmluZyhw
cml2LCBza2IpOw0KKwlkZXYtPnRyYW5zX3N0YXJ0ID0gamlmZmllczsgLyog
c2F2ZSB0aGUgdGltZXN0YW1wICovDQogDQotCXByaXYtPnJlZ3MtPmRtYV9j
dHJsfD1NRVRIX0RNQV9UWF9JTlRfRU47DQorCS8qIElmIFRYIHJpbmcgaXMg
ZnVsbCwgdGVsbCB0aGUgdXBwZXIgbGF5ZXIgdG8gc3RvcCBzZW5kaW5nIHBh
Y2tldHMgKi8NCisJaWYgKG1ldGhfdHhfZnVsbChkZXYpKSB7DQorCSAgICAg
ICAgRFBSSU5USygiVFggZnVsbDogc3RvcHBpbmdcbiIpOw0KKwkJbmV0aWZf
c3RvcF9xdWV1ZShkZXYpOw0KKwl9DQogDQotCXNwaW5fdW5sb2NrKCZwcml2
LT5tZXRoX2xvY2spOw0KKwlzcGluX3VubG9ja19pcnEoJnByaXYtPm1ldGhf
bG9jayk7DQogDQotICAgIHJldHVybiAwOw0KKwlyZXR1cm4gMDsNCiB9DQog
DQogLyoNCiAgKiBEZWFsIHdpdGggYSB0cmFuc21pdCB0aW1lb3V0Lg0KICAq
Lw0KLSAvKg0KKw0KIHZvaWQgbWV0aF90eF90aW1lb3V0IChzdHJ1Y3QgbmV0
X2RldmljZSAqZGV2KQ0KIHsNCi0gICAgc3RydWN0IG1ldGhfcHJpdmF0ZSAq
cHJpdiA9IChzdHJ1Y3QgbWV0aF9wcml2YXRlICopIGRldi0+cHJpdjsNCisJ
c3RydWN0IG1ldGhfcHJpdmF0ZSAqcHJpdiA9IChzdHJ1Y3QgbWV0aF9wcml2
YXRlICopIGRldi0+cHJpdjsNCisJDQorCXByaW50ayhLRVJOX1dBUk5JTkcg
IiVzOiB0cmFuc21pdCB0aW1lZCBvdXRcbiIsIGRldi0+bmFtZSk7DQogDQot
ICAgIERQUklOVEsoIlRyYW5zbWl0IHRpbWVvdXQgYXQgJWxkLCBsYXRlbmN5
ICVsZFxuIiwgamlmZmllcywNCi0gICAgICAgICAgICAgICAgICAgIGppZmZp
ZXMgLSBkZXYtPnRyYW5zX3N0YXJ0KTsNCi0gICAgcHJpdi0+c3RhdHVzID0g
bWV0aF9UWF9JTlRSOw0KLSAgICBtZXRoX2ludGVycnVwdCgwLCBkZXYsIE5V
TEwpOw0KLSAgICBwcml2LT5zdGF0cy50eF9lcnJvcnMrKzsNCi0gICAgbmV0
aWZfd2FrZV9xdWV1ZShkZXYpOw0KLSAgICByZXR1cm47DQorCS8qIFByb3Rl
Y3QgYWdhaW5zdCBjb25jdXJyZW50IHJ4IGludGVycnVwdHMgKi8NCisJc3Bp
bl9sb2NrX2lycSgmcHJpdi0+bWV0aF9sb2NrKTsNCisNCisJLyogVHJ5IHRv
IHJlc2V0IHRoZSBhZGFwdG9yLiAqLw0KKwltZXRoX3Jlc2V0KGRldik7DQor
DQorCXByaXYtPnN0YXRzLnR4X2Vycm9ycysrOw0KKw0KKwkvKiBDbGVhciBh
bGwgcmluZ3MgKi8NCisJbWV0aF9mcmVlX3R4X3JpbmcocHJpdik7DQorCW1l
dGhfZnJlZV9yeF9yaW5nKHByaXYpOw0KKwltZXRoX2luaXRfdHhfcmluZyhw
cml2KTsNCisJbWV0aF9pbml0X3J4X3JpbmcocHJpdik7DQorDQorCS8qIFJl
c3RhcnQgZG1hICovDQorCXByaXYtPnJlZ3MtPmRtYV9jdHJsfD1NRVRIX0RN
QV9UWF9FTnxNRVRIX0RNQV9SWF9FTnxNRVRIX0RNQV9SWF9JTlRfRU47DQor
DQorCS8qIEVuYWJsZSBpbnRlcnJ1cHQgKi8NCisJc3Bpbl91bmxvY2tfaXJx
KCZwcml2LT5tZXRoX2xvY2spOw0KKw0KKwlkZXYtPnRyYW5zX3N0YXJ0ID0g
amlmZmllczsNCisJbmV0aWZfd2FrZV9xdWV1ZShkZXYpOw0KKw0KKwlyZXR1
cm47DQogfQ0KLSovDQorDQogLyoNCiAgKiBJb2N0bCBjb21tYW5kcyANCiAg
Ki8NCkBAIC01NjAsNzUgKzc3NCw1OCBAQA0KIGludCBtZXRoX2luaXQoc3Ry
dWN0IG5ldF9kZXZpY2UgKmRldikNCiB7DQogCW1ldGhfcHJpdmF0ZSAqcHJp
djsNCi0Jdm9sYXRpbGUgbWV0aF9yZWdzKiByZWdzOw0KIAlpbnQgcmV0Ow0K
LSAgICAvKiANCi0gICAgICogVGhlbiwgYXNzaWduIG90aGVyIGZpZWxkcyBp
biBkZXYsIHVzaW5nIGV0aGVyX3NldHVwKCkgYW5kIHNvbWUNCi0gICAgICog
aGFuZCBhc3NpZ25tZW50cw0KLSAgICAgKi8NCi0gICAgZXRoZXJfc2V0dXAo
ZGV2KTsgLyogYXNzaWduIHNvbWUgb2YgdGhlIGZpZWxkcyAqLw0KLQ0KLSAg
ICBkZXYtPm9wZW4gICAgICAgICAgICA9IG1ldGhfb3BlbjsNCi0gICAgZGV2
LT5zdG9wICAgICAgICAgICAgPSBtZXRoX3JlbGVhc2U7DQotICAgIGRldi0+
c2V0X2NvbmZpZyAgICAgID0gbWV0aF9jb25maWc7DQotICAgIGRldi0+aGFy
ZF9zdGFydF94bWl0ID0gbWV0aF90eDsNCi0gICAgZGV2LT5kb19pb2N0bCAg
ICAgICAgPSBtZXRoX2lvY3RsOw0KLSAgICBkZXYtPmdldF9zdGF0cyAgICAg
ICA9IG1ldGhfc3RhdHM7DQotLyojaWZkZWYgSEFWRV9UWF9USU1FT1VUDQot
ICAgIGRldi0+dHhfdGltZW91dCAgICAgPSBtZXRoX3R4X3RpbWVvdXQ7DQot
ICAgIGRldi0+d2F0Y2hkb2dfdGltZW8gPSB0aW1lb3V0Ow0KLSNlbmRpZiov
DQotCWRldi0+aXJxCQkJPSBNQUNFX0VUSEVSTkVUX0lSUTsNCi0gICAgU0VU
X01PRFVMRV9PV05FUihkZXYpOw0KLQ0KLSAgICAvKg0KLSAgICAgKiBUaGVu
LCBhbGxvY2F0ZSB0aGUgcHJpdiBmaWVsZC4gVGhpcyBlbmNsb3NlcyB0aGUg
c3RhdGlzdGljcw0KLSAgICAgKiBhbmQgYSBmZXcgcHJpdmF0ZSBmaWVsZHMu
DQotICAgICAqLw0KLSAgICBwcml2ID0ga21hbGxvYyhzaXplb2Yoc3RydWN0
IG1ldGhfcHJpdmF0ZSksIEdGUF9LRVJORUwpOw0KLSAgICBpZiAocHJpdiA9
PSBOVUxMKQ0KLSAgICAgICAgcmV0dXJuIC1FTk9NRU07DQorCS8qIA0KKwkg
KiBUaGVuLCBhc3NpZ24gb3RoZXIgZmllbGRzIGluIGRldiwgdXNpbmcgZXRo
ZXJfc2V0dXAoKSBhbmQgc29tZQ0KKwkgKiBoYW5kIGFzc2lnbm1lbnRzDQor
CSAqLw0KKwlldGhlcl9zZXR1cChkZXYpOyAvKiBhc3NpZ24gc29tZSBvZiB0
aGUgZmllbGRzICovDQorDQorCWRldi0+b3BlbiAgICAgICAgICAgID0gbWV0
aF9vcGVuOw0KKwlkZXYtPnN0b3AgICAgICAgICAgICA9IG1ldGhfcmVsZWFz
ZTsNCisJZGV2LT5zZXRfY29uZmlnICAgICAgPSBtZXRoX2NvbmZpZzsNCisJ
ZGV2LT5oYXJkX3N0YXJ0X3htaXQgPSBtZXRoX3R4Ow0KKwlkZXYtPmRvX2lv
Y3RsICAgICAgICA9IG1ldGhfaW9jdGw7DQorCWRldi0+Z2V0X3N0YXRzICAg
ICAgID0gbWV0aF9zdGF0czsNCisjaWZkZWYgSEFWRV9UWF9USU1FT1VUDQor
CWRldi0+dHhfdGltZW91dCAgICAgID0gbWV0aF90eF90aW1lb3V0Ow0KKwlk
ZXYtPndhdGNoZG9nX3RpbWVvICA9IHRpbWVvdXQ7DQorI2VuZGlmDQorCWRl
di0+aXJxCQkgPSBNQUNFX0VUSEVSTkVUX0lSUTsNCisJU0VUX01PRFVMRV9P
V05FUihkZXYpOw0KKw0KKwkvKg0KKwkgKiBUaGVuLCBhbGxvY2F0ZSB0aGUg
cHJpdiBmaWVsZC4gVGhpcyBlbmNsb3NlcyB0aGUgc3RhdGlzdGljcw0KKwkg
KiBhbmQgYSBmZXcgcHJpdmF0ZSBmaWVsZHMuDQorCSAqLw0KKwlwcml2ID0g
a21hbGxvYyhzaXplb2Yoc3RydWN0IG1ldGhfcHJpdmF0ZSksIEdGUF9LRVJO
RUwpOw0KKwlpZiAocHJpdiA9PSBOVUxMKQ0KKwkJcmV0dXJuIC1FTk9NRU07
DQogCWRldi0+cHJpdj1wcml2Ow0KLSAgICBtZW1zZXQocHJpdiwgMCwgc2l6
ZW9mKHN0cnVjdCBtZXRoX3ByaXZhdGUpKTsNCi0gICAgc3Bpbl9sb2NrX2lu
aXQoJiAoc3RydWN0IG1ldGhfcHJpdmF0ZSAqKSAoZGV2LT5wcml2KS0+bWV0
aF9sb2NrKTsNCi0gICAgLyoNCi0gICAgICogTWFrZSB0aGUgdXN1YWwgY2hl
Y2tzOiBjaGVja19yZWdpb24oKSwgcHJvYmUgaXJxLCAuLi4gIC1FTk9ERVYN
Ci0gICAgICogc2hvdWxkIGJlIHJldHVybmVkIGlmIG5vIGRldmljZSBmb3Vu
ZC4gIE5vIHJlc291cmNlIHNob3VsZCBiZQ0KLSAgICAgKiBncmFiYmVkOiB0
aGlzIGlzIGRvbmUgb24gb3BlbigpLiANCi0gICAgICovDQorCW1lbXNldChw
cml2LCAwLCBzaXplb2Yoc3RydWN0IG1ldGhfcHJpdmF0ZSkpOw0KKwlzcGlu
X2xvY2tfaW5pdCgmKChzdHJ1Y3QgbWV0aF9wcml2YXRlICopIGRldi0+cHJp
diktPm1ldGhfbG9jayk7DQorCS8qDQorCSAqIE1ha2UgdGhlIHVzdWFsIGNo
ZWNrczogY2hlY2tfcmVnaW9uKCksIHByb2JlIGlycSwgLi4uICAtRU5PREVW
DQorCSAqIHNob3VsZCBiZSByZXR1cm5lZCBpZiBubyBkZXZpY2UgZm91bmQu
ICBObyByZXNvdXJjZSBzaG91bGQgYmUNCisJICogZ3JhYmJlZDogdGhpcyBp
cyBkb25lIG9uIG9wZW4oKS4gDQorCSAqLw0KIAlwcml2LT5yZWdzPShtZXRo
X3JlZ3MqKVNHSV9NRkU7DQogCWRldi0+YmFzZV9hZGRyPVNHSV9NRkU7DQor
CXByaXYtPnBoeV9hZGRyID0gLTE7IC8qIE5vIHBoeSBpcyBrbm93biB5ZXQu
Li4gKi8NCiANCi0JcmVncz0obWV0aF9yZWdzKilTR0lfTUZFOw0KLQ0KLQkv
KiBSZXNldCBjYXJkICovDQotCXJlZ3MtPm1hY19jdHJsPVNHSV9NQUNfUkVT
RVQ7DQotCXJlZ3MtPm1hY19jdHJsPTA7DQotCXVkZWxheSgyNSk7DQotCURQ
UklOVEsoIk1BQyBjb250cm9sIGFmdGVyIHJlc2V0OiAlMDE2bHhcbiIscmVn
cy0+bWFjX2N0cmwpOw0KLQlwcmludGsoIlNHSSBPMiBGYXN0IEV0aGVybmV0
IHJldi4gJWxkXG4iLHJlZ3MtPm1hY19jdHJsPj4yOSk7DQotDQotCWxvYWRf
ZWFkZHIoZGV2LHJlZ3MpOw0KLQlwcml2LT5waHlfYWRkcj0tMTsgLyogTm8g
cGh5IGlzIGtub3duIHlldC4uLiAqLw0KLQlpZihtZGlvX3Byb2JlKHByaXYp
PDApew0KLQkJRFBSSU5USygiVW5hYmxlIHRvIGZpbmQgUEhZXG4iKTsNCi0J
CXJldHVybiAtRU5PREVWOw0KLQl9DQotCS8qIFNob3VsZCBsb2FkIHNvbWUg
ImVycmF0YSIsIGJ1dCBsYXRlciAqLw0KLQkNCi0JLyogSW5pdGlhbCBtb2Rl
IC0tIDEwMHxIYWxmLWR1cGxleHxBY2VwdCBub3JtYWwgcGFja2V0cyAqLw0K
LQlwcml2LT5tb2RlPU1FVEhfQUNDRVBUX01DQVNUfE1FVEhfMTAwTUJJVHxN
RVRIX0RFRkFVTFRfSVBHOw0KLQlpZihkZXYtPmZsYWdzfElGRl9QUk9NSVND
KQ0KLQkJcHJpdi0+bW9kZXw9TUVUSF9QUk9NSVNDOw0KLQlyZWdzLT5tYWNf
Y3RybD1wcml2LT5tb2RlOw0KKwkvKiBJbml0aWFsaXplIHRoZSBoYXJkd2Fy
ZSAqLw0KKwlpZigocmV0PW1ldGhfcmVzZXQoZGV2KSkgPCAwKQ0KKwkgICAg
ICAgIHJldHVybiByZXQ7DQogDQorCS8qIEFsbG9jYXRlIHRoZSByaW5nIGJ1
ZmZlcnMgKi8NCiAJaWYoKHJldD1tZXRoX2luaXRfdHhfcmluZyhwcml2KSk8
MHx8KHJldD1tZXRoX2luaXRfcnhfcmluZyhwcml2KSk8MCl7DQogCQltZXRo
X2ZyZWVfdHhfcmluZyhwcml2KTsNCiAJCW1ldGhfZnJlZV9yeF9yaW5nKHBy
aXYpOw0KIAkJcmV0dXJuIHJldDsNCiAJfQ0KLQkvKiBOb3cgc2V0IGRtYSBj
b250cm9sLCBidXQgZG9uJ3QgZW5hYmxlIERNQSwgeWV0ICovDQotCXByaXYt
PnJlZ3MtPmRtYV9jdHJsPSg0PDxNRVRIX1JYX09GRlNFVF9TSElGVCl8KFJY
X1JJTkdfRU5UUklFUzw8TUVUSF9SWF9ERVBUSF9TSElGVCk7DQorDQorCXBy
aW50aygiU0dJIE8yIEZhc3QgRXRoZXJuZXQgcmV2LiAlbGRcbiIsIHByaXYt
PnJlZ3MtPm1hY19jdHJsID4+IDI5KTsNCisNCiAgICAgcmV0dXJuIDA7DQog
fQ0KIA0KQEAgLTY0NiwyMCArODQzLDE5IEBADQogDQogaW50IG1ldGhfaW5p
dF9tb2R1bGUodm9pZCkNCiB7DQotDQotICAgIGludCByZXN1bHQsIGRldmlj
ZV9wcmVzZW50ID0gMDsNCisJaW50IHJlc3VsdCwgZGV2aWNlX3ByZXNlbnQg
PSAwOw0KIA0KIAlzdHJjcHkobWV0aF9kZXZzWzBdLm5hbWUsICJldGglZCIp
Ow0KIA0KIAlpZiAoIChyZXN1bHQgPSByZWdpc3Rlcl9uZXRkZXYobWV0aF9k
ZXZzKSkgKQ0KLSAgICAgICAgcHJpbnRrKCJtZXRoOiBlcnJvciAlaSByZWdp
c3RlcmluZyBkZXZpY2UgXCIlc1wiXG4iLA0KLSAgICAgICAgICAgICAgICAg
ICByZXN1bHQsIG1ldGhfZGV2cy0+bmFtZSk7DQorCQlwcmludGsoIm1ldGg6
IGVycm9yICVpIHJlZ2lzdGVyaW5nIGRldmljZSBcIiVzXCJcbiIsDQorCQkg
ICAgICAgcmVzdWx0LCBtZXRoX2RldnMtPm5hbWUpOw0KIAllbHNlIGRldmlj
ZV9wcmVzZW50Kys7DQogI2lmbmRlZiBNRVRIX0RFQlVHDQotICAgIEVYUE9S
VF9OT19TWU1CT0xTOw0KKwlFWFBPUlRfTk9fU1lNQk9MUzsNCiAjZW5kaWYN
Ci0NCi0gICAgcmV0dXJuIGRldmljZV9wcmVzZW50ID8gMCA6IC1FTk9ERVY7
DQorCQ0KKwlyZXR1cm4gZGV2aWNlX3ByZXNlbnQgPyAwIDogLUVOT0RFVjsN
CiB9DQogDQogdm9pZCBtZXRoX2NsZWFudXAodm9pZCkNCi0tLSBsaW51eC9k
cml2ZXJzL25ldC9tZXRoLmgJU3VuIERlYyAgOSAxNTo0OToyNSAyMDAxDQor
KysgbGludXguYnVpbGQvZHJpdmVycy9uZXQvbWV0aC5oCVN1biBKYW4gIDYg
MTU6NDU6NDMgMjAwMg0KQEAgLTEwOCw4ICsxMDgsOSBAQA0KIA0KIHR5cGVk
ZWYgc3RydWN0IHJ4X3BhY2tldCB7DQogCXJ4X3N0YXR1c192ZWN0b3Igc3Rh
dHVzOw0KLQl1NjQgcGFkWzRdOyAvKiBGb3Igd2hhdGV2ZXIgcmVhc29uLCB0
aGVyZSBuZWVkcyB0byBiZSA0IGRvdWJsZS13b3JkIG9mZnNldCAqLw0KLQlj
aGFyIGJ1ZltNRVRIX1JYX0JVRkZfU0laRS1zaXplb2Yocnhfc3RhdHVzX3Zl
Y3Rvciktc2l6ZW9mKHU2NCldOy8qIGRhdGEgKi8NCisgICAgICAgIHU2NCBw
YWRbM107IC8qIEZvciB3aGF0ZXZlciByZWFzb24sIHRoZXJlIG5lZWRzIHRv
IGJlIDQgZG91YmxlLXdvcmQgb2Zmc2V0ICovDQorICAgICAgICB1MTYgcGFk
MjsNCisJY2hhciBidWZbTUVUSF9SWF9CVUZGX1NJWkUtc2l6ZW9mKHJ4X3N0
YXR1c192ZWN0b3IpLTMqc2l6ZW9mKHU2NCktc2l6ZW9mKHUxNildOy8qIGRh
dGEgKi8NCiB9IHJ4X3BhY2tldDsNCiANCiB0eXBlZGVmIHN0cnVjdCBtZXRo
X3JlZ3Mgew0KQEAgLTIzOSwxMyArMjQwLDEzIEBADQogI2RlZmluZSBNRVRI
X0lOVF9SWF9VTkRFUkZMT1cJQklUKDYpCS8qIDA6IE5vIGludGVycnVwdCBw
ZW5kaW5nLCAxOiBGSUZPIHdhcyBlbXB0eSwgcGFja2V0IGNvdWxkIG5vdCBi
ZSBxdWV1ZWQgKi8NCiAjZGVmaW5lIE1FVEhfSU5UX1JYX09WRVJGTE9XCQlC
SVQoNykJLyogMDogTm8gaW50ZXJydXB0IHBlbmRpbmcsIDE6IERNQSBGSUZP
IE92ZXJmbG93LCBETUEgc3RvcHBlZCwgRkFUQUwgKi8NCiANCi0JCQkJCQkv
KiBCaXRzIDggdGhyb3VnaCAxMiBhbGlhcyBvZiBSWCByZWFkLXBvaW50ZXIg
Ki8NCisjZGVmaW5lIE1FVEhfSU5UX1JYX1JQVFJfTUFTSyAweDAwMDFGMDAJ
CS8qIEJpdHMgOCB0aHJvdWdoIDEyIGFsaWFzIG9mIFJYIHJlYWQtcG9pbnRl
ciAqLw0KIA0KIAkJCQkJCS8qIEJpdHMgMTMgdGhyb3VnaCAxNSBhcmUgYWx3
YXlzIDAuICovDQogDQotI2RlZmluZSBNRVRIX0lOVF9SUFRSX01BU0sgMHgx
RkYwMDAwCS8qIEJpdHMgMTYgdGhyb3VnaCAyNCBhbGlhcyBvZiBUWCByZWFk
LXBvaW50ZXIgKi8NCisjZGVmaW5lIE1FVEhfSU5UX1RYX1JQVFJfTUFTSyAw
eDFGRjAwMDAJICAgICAgICAvKiBCaXRzIDE2IHRocm91Z2ggMjQgYWxpYXMg
b2YgVFggcmVhZC1wb2ludGVyICovDQogDQotCQkJCQkJLyogQml0cyAyNSB0
aHJvdWdoIDI5IGFyZSB0aGUgc3RhcnRpbmcgc2VxIG51bWJlciBmb3IgdGhl
IG1lc3NhZ2UgYXQgdGhlICovDQorI2RlZmluZSBNRVRIX0lOVF9TRVFfTUFT
SyAgICAweDJFMDAwMDAwCSAgICAgICAgLyogQml0cyAyNSB0aHJvdWdoIDI5
IGFyZSB0aGUgc3RhcnRpbmcgc2VxIG51bWJlciBmb3IgdGhlIG1lc3NhZ2Ug
YXQgdGhlICovDQogCQkJCQkJLyogdG9wIG9mIHRoZSBxdWV1ZSAqLw0KIA0K
ICNkZWZpbmUgTUVUSF9FUlJPUlMgKCBcDQo=
--279724308-970882123-1025551760=:27848--

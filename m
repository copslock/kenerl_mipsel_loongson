Received:  by oss.sgi.com id <S553679AbQJUCs7>;
	Fri, 20 Oct 2000 19:48:59 -0700
Received: from gateway-490.mvista.com ([63.192.220.206]:33016 "EHLO
        hermes.mvista.com") by oss.sgi.com with ESMTP id <S553660AbQJUCsk>;
	Fri, 20 Oct 2000 19:48:40 -0700
Received: from mvista.com (IDENT:jsun@orion.mvista.com [10.0.0.75])
	by hermes.mvista.com (8.11.0/8.11.0) with ESMTP id e9L2lGx31155;
	Fri, 20 Oct 2000 19:47:16 -0700
Message-ID: <39F1045B.21EF1851@mvista.com>
Date:   Fri, 20 Oct 2000 19:50:03 -0700
From:   Jun Sun <jsun@mvista.com>
X-Mailer: Mozilla 4.72 [en] (X11; U; Linux 2.2.14-5.0 i586)
X-Accept-Language: en
MIME-Version: 1.0
To:     linux-mips@oss.sgi.com
Subject: problems with insmod ...
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Sender: owner-linux-mips@oss.sgi.com
Precedence: bulk
Return-Path: <owner-linux-mips@oss.sgi.com>
X-Orcpt: rfc822;linux-mips-outgoing


I am using modutils v2.1.121, generated by binutils 2.8.1/egcs
v1.0.3a/glibc 2.0.6.

I have several problems with it.

In obj/obj_mipsel.c arch_apply_relocation() function, the mips_hi16_list
is not initialized to NULL before it is used as a list head.  So, later,
insmod dies at trying to access 0x41.

(BTW, it seems horrible to me that arch_apply_relocation() remaps
obj_file struct to a local mips_file struct, destroying the original ELF
header struct.  Is this safe?)

I kind of hacked around this problem (I don't know the real fix), but I
got some other problems.  This time it is at obj/obj_reloc.c:410 -
sec->contents is 0x0.  It seems to me that this section should be
included in load list at the first place.  Does somebody why it is
there?  

I dumped the section info here :

(gdb) p/x *f->load_order->load_next->load_next
$22 = {
  header = {
    sh_name = 0x36,
    sh_type = 0x70000006,
    sh_flags = 0x2,
    sh_addr = 0xc00000e0,
    sh_offset = 0xd0,
    sh_size = 0x18,
    sh_link = 0x0,
    sh_info = 0x0,
    sh_addralign = 0x4,
    sh_entsize = 0x1
  },
  name = 0x1001bf26,
  contents = 0x0,
  load_next = 0x1001bd88,
  idx = 0x5
}

=======

BTW, I seem to remember someone said the modutils 2.1.121 is not good
MIPS.  Which version is good?

Jun

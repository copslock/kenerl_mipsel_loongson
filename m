Received: with ECARTIS (v1.0.0; list linux-mips); Wed, 12 May 2010 10:41:35 +0200 (CEST)
Received: from cantor2.suse.de ([195.135.220.15]:34462 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by eddie.linux-mips.org with ESMTP
        id S1491187Ab0ELIl2 (ORCPT <rfc822;linux-mips@linux-mips.org>);
        Wed, 12 May 2010 10:41:28 +0200
Received: from relay1.suse.de (charybdis-ext.suse.de [195.135.221.2])
        by mx2.suse.de (Postfix) with ESMTP id 6A03987104;
        Wed, 12 May 2010 10:41:28 +0200 (CEST)
Date:   Wed, 12 May 2010 10:41:28 +0200
Message-ID: <s5heihhse9z.wl%tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Ralf Baechle <ralf@linux-mips.org>
Cc:     wuzhangjin@gmail.com, linux-mips <linux-mips@linux-mips.org>
Subject: Re: About MIPS specific dma_mmap_coherent()
In-Reply-To: <20100511184844.GA7978@linux-mips.org>
References: <1271134735.25797.35.camel@falcon>
        <s5hmxx7z4a7.wl%tiwai@suse.de>
        <1271218889.25872.27.camel@falcon>
        <s5hzl164kay.wl%tiwai@suse.de>
        <1271235619.25872.148.camel@falcon>
        <s5h633uxcje.wl%tiwai@suse.de>
        <20100511184844.GA7978@linux-mips.org>
User-Agent: Wanderlust/2.15.6 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.7 Emacs/23.1
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Return-Path: <tiwai@suse.de>
X-Envelope-To: <"|/home/ecartis/ecartis -s linux-mips"> (uid 0)
X-Orcpt: rfc822;linux-mips@linux-mips.org
Original-Recipient: rfc822;linux-mips@linux-mips.org
X-archive-position: 26680
X-ecartis-version: Ecartis v1.0.0
Sender: linux-mips-bounce@linux-mips.org
Errors-to: linux-mips-bounce@linux-mips.org
X-original-sender: tiwai@suse.de
Precedence: bulk
X-list: linux-mips

At Tue, 11 May 2010 19:48:44 +0100,
Ralf Baechle wrote:
> 
> On Wed, Apr 14, 2010 at 05:46:13PM +0200, Takashi Iwai wrote:
> 
> > But, I remember vaguely that calling pgprot_noncached()
> > unconditionally is dangerous.  It should be checked somehow, e.g. via
> > platform_device_is_coherent().  And, this found only in
> > dma-coherence.h, and adding it to pcm_native.c would become messy like
> > below...
> > 
> > So, it'd be really better to add dma_mmap_coherent(), indeed.
> 
> We agreed that this was only meant as a stop gap meassure.  As such I do
> agree with either of
> 
>   http://patchwork.linux-mips.org/patch/1117/
>   http://patchwork.linux-mips.org/patch/1118/
> 
> Wu has tested the 1117 patch so that might make it preferable especially
> for 2.6.34 if we should go for that.

OK, I merged the patch now as Wu confirmed it's working.
Will be included in the next pull request.


thanks,

Takashi

Received: with ECARTIS (v1.0.0; list linux-mips); Sat, 10 Dec 2011 11:19:35 +0100 (CET)
Received: from mail-ww0-f43.google.com ([74.125.82.43]:49258 "EHLO
        mail-ww0-f43.google.com" rhost-flags-OK-OK-OK-OK)
        by eddie.linux-mips.org with ESMTP id S1903563Ab1LJKTb (ORCPT
        <rfc822;linux-mips@linux-mips.org>); Sat, 10 Dec 2011 11:19:31 +0100
Received: by wgbds11 with SMTP id ds11so6323737wgb.24
        for <linux-mips@linux-mips.org>; Sat, 10 Dec 2011 02:19:26 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=googlemail.com; s=gamma;
        h=from:to:mail-followup-to:cc:subject:references:date:in-reply-to
         :message-id:user-agent:mime-version:content-type;
        bh=FUD905LAPgordNukFEaefCmiCijTYj0y1kkzl0Abv38=;
        b=SH3ENlZ4Nzcy83AihLeoZx8iPAPoghL0CZrWo1WtirwXUc7UYYpnLjYUgpN/AdQb/G
         6OOSA+Q92FG4b9ChYKSHzvnAIDu3yKCl2cTDN5nj8EwpvWOTItF8i8uhuteuVFOXIzAv
         p4WUOnUj6zF6VBZX4wnoXCYNcSoyoeIvoaLm0=
Received: by 10.227.197.130 with SMTP id ek2mr9337696wbb.16.1323512366221;
        Sat, 10 Dec 2011 02:19:26 -0800 (PST)
Received: from localhost (rsandifo.gotadsl.co.uk. [82.133.89.107])
        by mx.google.com with ESMTPS id er5sm11037757wbb.11.2011.12.10.02.19.24
        (version=TLSv1/SSLv3 cipher=OTHER);
        Sat, 10 Dec 2011 02:19:25 -0800 (PST)
From:   Richard Sandiford <rdsandiford@googlemail.com>
To:     David Daney <david.daney@cavium.com>
Mail-Followup-To: David Daney <david.daney@cavium.com>,binutils <binutils@sourceware.org>,  Alan Modra <amodra@gmail.com>,  Manuel Lauss <manuel.lauss@googlemail.com>,  Debian MIPS <debian-mips@lists.debian.org>,  linux-mips <linux-mips@linux-mips.org>, rdsandiford@googlemail.com
Cc:     binutils <binutils@sourceware.org>, Alan Modra <amodra@gmail.com>,
        Manuel Lauss <manuel.lauss@googlemail.com>,
        Debian MIPS <debian-mips@lists.debian.org>,
        linux-mips <linux-mips@linux-mips.org>
Subject: Re: [Patch v2]: Fix ld pr11138 FAILures on mips*.
References: <4EE27012.5030508@cavium.com>
        <20111210003928.GC2461@bubble.grove.modra.org>
        <4EE2ACB9.9010301@cavium.com>
Date:   Sat, 10 Dec 2011 10:19:20 +0000
In-Reply-To: <4EE2ACB9.9010301@cavium.com> (David Daney's message of "Fri, 09
        Dec 2011 16:50:01 -0800")
Message-ID: <87y5ukenkn.fsf@firetop.home>
User-Agent: Gnus/5.13 (Gnus v5.13) Emacs/23.2 (gnu/linux)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
X-archive-position: 32082
X-ecartis-version: Ecartis v1.0.0
Sender: linux-mips-bounce@linux-mips.org
Errors-to: linux-mips-bounce@linux-mips.org
X-original-sender: rdsandiford@googlemail.com
Precedence: bulk
X-list: linux-mips
Return-Path: <linux-mips-bounce@linux-mips.org>
X-Keywords:                  
X-UID: 8288

David Daney <david.daney@cavium.com> writes:
> I will wait a couple of days to give Richard a chance to object.

Looks good to me too.  Thanks for doing this.  I think it should go
on the 2.22 branch as well.

> I am especially concerned about what happens on IRIX where the symbol
> comes in from an external object rather than being generated by the
> linker itself.  I had no way to test that.

Me neither, unfortunately.  But I agree it looks right.  There's a
possibility that we could create the dynamic sections before the
definition of __rld_obj_head has been read in (e.g. from the
check_relocs of a previous object).  In that case it looks like
we would create the .rld_map section and __rld_map/__RLD_MAP symbol,
then later switch to __rld_obj_head.  .rld_map would then be left
at zero size and the __rld_map/__RLD_MAP symbol would be ignored
when setting the tag value.  But your patch preserves the
behaviour in that case too.

Richard
